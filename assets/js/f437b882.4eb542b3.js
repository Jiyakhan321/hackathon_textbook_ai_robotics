"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[3275],{7454:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"module-2-digital-twin/gazebo-simulation/gazebo-ros-integration","title":"Gazebo-ROS Integration","description":"Overview","source":"@site/docs/module-2-digital-twin/gazebo-simulation/gazebo-ros-integration.md","sourceDirName":"module-2-digital-twin/gazebo-simulation","slug":"/module-2-digital-twin/gazebo-simulation/gazebo-ros-integration","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/gazebo-simulation/gazebo-ros-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics/tree/main/docs/module-2-digital-twin/gazebo-simulation/gazebo-ros-integration.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Physics Modeling for Humanoid Robots","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/gazebo-simulation/physics-modeling"},"next":{"title":"Sensor Simulation in Gazebo","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/gazebo-simulation/sensor-simulation"}}');var r=t(4848),i=t(8453);const s={sidebar_position:3},a="Gazebo-ROS Integration",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Gazebo-ROS Architecture",id:"gazebo-ros-architecture",level:2},{value:"Installing Gazebo-ROS Packages",id:"installing-gazebo-ros-packages",level:2},{value:"Essential Gazebo Plugins",id:"essential-gazebo-plugins",level:2},{value:"1. Robot State Publisher Plugin",id:"1-robot-state-publisher-plugin",level:3},{value:"2. Gazebo ROS Control Plugin",id:"2-gazebo-ros-control-plugin",level:3},{value:"Configuring Robot Control",id:"configuring-robot-control",level:2},{value:"1. Control Configuration File",id:"1-control-configuration-file",level:3},{value:"2. URDF Integration with Control",id:"2-urdf-integration-with-control",level:3},{value:"Sensor Integration",id:"sensor-integration",level:2},{value:"1. IMU Sensor Plugin",id:"1-imu-sensor-plugin",level:3},{value:"2. Camera Sensor Plugin",id:"2-camera-sensor-plugin",level:3},{value:"3. LiDAR Sensor Plugin",id:"3-lidar-sensor-plugin",level:3},{value:"Launch Files for Integration",id:"launch-files-for-integration",level:2},{value:"1. Complete Launch File",id:"1-complete-launch-file",level:3},{value:"2. Controller Spawning Launch File",id:"2-controller-spawning-launch-file",level:3},{value:"Testing the Integration",id:"testing-the-integration",level:2},{value:"1. Basic Integration Test",id:"1-basic-integration-test",level:3},{value:"2. Advanced Control Test",id:"2-advanced-control-test",level:3},{value:"Troubleshooting Common Integration Issues",id:"troubleshooting-common-integration-issues",level:2},{value:"1. Controller Loading Issues",id:"1-controller-loading-issues",level:3},{value:"2. TF Tree Issues",id:"2-tf-tree-issues",level:3},{value:"3. Sensor Data Issues",id:"3-sensor-data-issues",level:3},{value:"Advanced Integration Features",id:"advanced-integration-features",level:2},{value:"1. Gazebo Services",id:"1-gazebo-services",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"1. Efficient Update Rates",id:"1-efficient-update-rates",level:3},{value:"2. Threading Configuration",id:"2-threading-configuration",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:2},{value:"1. Communication Problems",id:"1-communication-problems",level:3},{value:"2. Performance Issues",id:"2-performance-issues",level:3},{value:"Testing and Validation",id:"testing-and-validation",level:2},{value:"1. Communication Validation Script",id:"1-communication-validation-script",level:3},{value:"Next Steps",id:"next-steps",level:2}];function _(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"gazebo-ros-integration",children:"Gazebo-ROS Integration"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Gazebo-ROS integration enables seamless communication between your simulated humanoid robot and the ROS 2 ecosystem. This integration allows you to use the same control nodes, perception algorithms, and other ROS 2 components with your simulation as you would with a real robot. In this section, we'll explore how to properly integrate Gazebo with ROS 2 for humanoid robot simulation."}),"\n",(0,r.jsx)(n.h2,{id:"gazebo-ros-architecture",children:"Gazebo-ROS Architecture"}),"\n",(0,r.jsx)(n.p,{children:"The Gazebo-ROS integration works through plugins that bridge the gap between Gazebo's simulation environment and ROS 2's communication system:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Gazebo ROS PKGs"}),": Provide ROS interfaces for Gazebo simulation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sensor Plugins"}),": Convert Gazebo sensor data to ROS messages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Actuator Plugins"}),": Convert ROS commands to Gazebo actuator control"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Robot State Publisher"}),": Maintains the robot's transform tree"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"installing-gazebo-ros-packages",children:"Installing Gazebo-ROS Packages"}),"\n",(0,r.jsx)(n.p,{children:"First, ensure you have the necessary packages installed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Install Gazebo ROS packages for Humble\nsudo apt update\nsudo apt install ros-humble-gazebo-ros-pkgs\nsudo apt install ros-humble-gazebo-ros2-control\nsudo apt install ros-humble-gazebo-dev\n"})}),"\n",(0,r.jsx)(n.h2,{id:"essential-gazebo-plugins",children:"Essential Gazebo Plugins"}),"\n",(0,r.jsx)(n.h3,{id:"1-robot-state-publisher-plugin",children:"1. Robot State Publisher Plugin"}),"\n",(0,r.jsx)(n.p,{children:"Add this to your world file or robot model to enable TF publishing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'\x3c!-- In your world file --\x3e\n<gazebo>\n  <plugin filename="libgazebo_ros_init.so" name="gazebo_ros_init">\n    <ros>\n      <namespace>/humanoid_robot</namespace>\n    </ros>\n  </plugin>\n</gazebo>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-gazebo-ros-control-plugin",children:"2. Gazebo ROS Control Plugin"}),"\n",(0,r.jsx)(n.p,{children:"This plugin enables ROS 2 control of your robot's joints:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'\x3c!-- Add to your robot model (URDF/XACRO) --\x3e\n<gazebo>\n  <plugin name="gazebo_ros_control" filename="libgazebo_ros2_control.so">\n    <parameters>$(find my_robot_description)/config/humanoid_control.yaml</parameters>\n    <robot_namespace>/humanoid_robot</robot_namespace>\n  </plugin>\n</gazebo>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"configuring-robot-control",children:"Configuring Robot Control"}),"\n",(0,r.jsx)(n.h3,{id:"1-control-configuration-file",children:"1. Control Configuration File"}),"\n",(0,r.jsx)(n.p,{children:"Create a control configuration file that defines your robot's controllers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# config/humanoid_control.yaml\ncontroller_manager:\n  ros__parameters:\n    update_rate: 1000  # Hz\n\n    # Joint Trajectory Controller\n    joint_trajectory_controller:\n      type: joint_trajectory_controller/JointTrajectoryController\n\n    # Individual joint controllers\n    left_leg_controller:\n      type: joint_group_position_controller/JointGroupPositionController\n    right_leg_controller:\n      type: joint_group_position_controller/JointGroupPositionController\n    left_arm_controller:\n      type: joint_group_position_controller/JointGroupPositionController\n    right_arm_controller:\n      type: joint_group_position_controller/JointGroupPositionController\n\n# Joint Trajectory Controller Configuration\njoint_trajectory_controller:\n  ros__parameters:\n    joints:\n      - left_hip_pitch_joint\n      - left_hip_roll_joint\n      - left_hip_yaw_joint\n      - left_knee_joint\n      - left_ankle_pitch_joint\n      - left_ankle_roll_joint\n      - right_hip_pitch_joint\n      - right_hip_roll_joint\n      - right_hip_yaw_joint\n      - right_knee_joint\n      - right_ankle_pitch_joint\n      - right_ankle_roll_joint\n      - left_shoulder_pitch_joint\n      - left_shoulder_roll_joint\n      - left_elbow_joint\n      - right_shoulder_pitch_joint\n      - right_shoulder_roll_joint\n      - right_elbow_joint\n    interface_name: position\n\n# Left Leg Controller\nleft_leg_controller:\n  ros__parameters:\n    joints:\n      - left_hip_pitch_joint\n      - left_hip_roll_joint\n      - left_hip_yaw_joint\n      - left_knee_joint\n      - left_ankle_pitch_joint\n      - left_ankle_roll_joint\n\n# Right Leg Controller\nright_leg_controller:\n  ros__parameters:\n    joints:\n      - right_hip_pitch_joint\n      - right_hip_roll_joint\n      - right_hip_yaw_joint\n      - right_knee_joint\n      - right_ankle_pitch_joint\n      - right_ankle_roll_joint\n\n# Left Arm Controller\nleft_arm_controller:\n  ros__parameters:\n    joints:\n      - left_shoulder_pitch_joint\n      - left_shoulder_roll_joint\n      - left_elbow_joint\n\n# Right Arm Controller\nright_arm_controller:\n  ros__parameters:\n    joints:\n      - right_shoulder_pitch_joint\n      - right_shoulder_roll_joint\n      - right_elbow_joint\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-urdf-integration-with-control",children:"2. URDF Integration with Control"}),"\n",(0,r.jsx)(n.p,{children:"Update your URDF to include transmission elements for control:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<robot name="humanoid_with_control" xmlns:xacro="http://www.ros.org/wiki/xacro">\n\n  \x3c!-- Your existing URDF content --\x3e\n\n  \x3c!-- Transmission elements for ROS Control --\x3e\n  <transmission name="left_hip_pitch_trans" type="transmission_interface/SimpleTransmission">\n    <joint name="left_hip_pitch_joint">\n      <hardwareInterface>position_controllers/JointPositionController</hardwareInterface>\n    </joint>\n    <actuator name="left_hip_pitch_motor">\n      <mechanicalReduction>1</mechanicalReduction>\n    </actuator>\n  </transmission>\n\n  <transmission name="left_hip_roll_trans" type="transmission_interface/SimpleTransmission">\n    <joint name="left_hip_roll_joint">\n      <hardwareInterface>position_controllers/JointPositionController</hardwareInterface>\n    </joint>\n    <actuator name="left_hip_roll_motor">\n      <mechanicalReduction>1</mechanicalReduction>\n    </actuator>\n  </transmission>\n\n  <transmission name="left_hip_yaw_trans" type="transmission_interface/SimpleTransmission">\n    <joint name="left_hip_yaw_joint">\n      <hardwareInterface>position_controllers/JointPositionController</hardwareInterface>\n    </joint>\n    <actuator name="left_hip_yaw_motor">\n      <mechanicalReduction>1</mechanicalReduction>\n    </actuator>\n  </transmission>\n\n  \x3c!-- Add transmissions for all joints you want to control --\x3e\n  \x3c!-- ... more transmissions ... --\x3e\n\n  \x3c!-- Gazebo ROS Control Plugin --\x3e\n  <gazebo>\n    <plugin name="gazebo_ros_control" filename="libgazebo_ros2_control.so">\n      <parameters>$(find my_robot_description)/config/humanoid_control.yaml</parameters>\n      <robot_namespace>/humanoid_robot</robot_namespace>\n    </plugin>\n  </gazebo>\n\n</robot>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"sensor-integration",children:"Sensor Integration"}),"\n",(0,r.jsx)(n.h3,{id:"1-imu-sensor-plugin",children:"1. IMU Sensor Plugin"}),"\n",(0,r.jsx)(n.p,{children:"Add IMU sensor to your robot for balance and orientation feedback:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'\x3c!-- Add to your base_link or torso link --\x3e\n<gazebo reference="base_link">\n  <sensor name="imu_sensor" type="imu">\n    <always_on>true</always_on>\n    <update_rate>100</update_rate>\n    <visualize>true</visualize>\n    <imu>\n      <angular_velocity>\n        <x>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>0.02</stddev>\n          </noise>\n        </x>\n        <y>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>0.02</stddev>\n          </noise>\n        </y>\n        <z>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>0.02</stddev>\n          </noise>\n        </z>\n      </angular_velocity>\n      <linear_acceleration>\n        <x>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>1.7e-2</stddev>\n          </noise>\n        </x>\n        <y>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>1.7e-2</stddev>\n          </noise>\n        </y>\n        <z>\n          <noise type="gaussian">\n            <mean>0.0</mean>\n            <stddev>1.7e-2</stddev>\n          </noise>\n        </z>\n      </linear_acceleration>\n    </imu>\n    <ros>\n      <namespace>/humanoid_robot</namespace>\n      <remapping>~/out:=imu/data</remapping>\n    </ros>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-camera-sensor-plugin",children:"2. Camera Sensor Plugin"}),"\n",(0,r.jsx)(n.p,{children:"Add a camera for visual perception:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<gazebo reference="head_link">\n  <sensor name="camera" type="camera">\n    <always_on>true</always_on>\n    <update_rate>30</update_rate>\n    <camera name="head_camera">\n      <horizontal_fov>1.3962634</horizontal_fov> \x3c!-- 80 degrees --\x3e\n      <image>\n        <width>640</width>\n        <height>480</height>\n        <format>R8G8B8</format>\n      </image>\n      <clip>\n        <near>0.1</near>\n        <far>100</far>\n      </clip>\n    </camera>\n    <plugin name="camera_controller" filename="libgazebo_ros_camera.so">\n      <ros>\n        <namespace>/humanoid_robot</namespace>\n        <remapping>image_raw:=camera/image_raw</remapping>\n        <remapping>camera_info:=camera/camera_info</remapping>\n      </ros>\n      <camera_name>head_camera</camera_name>\n      <frame_name>head_camera_optical_frame</frame_name>\n      <hack_baseline>0.07</hack_baseline>\n      <distortion_k1>0.0</distortion_k1>\n      <distortion_k2>0.0</distortion_k2>\n      <distortion_k3>0.0</distortion_k3>\n      <distortion_t1>0.0</distortion_t1>\n      <distortion_t2>0.0</distortion_t2>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-lidar-sensor-plugin",children:"3. LiDAR Sensor Plugin"}),"\n",(0,r.jsx)(n.p,{children:"Add LiDAR for navigation and mapping:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<gazebo reference="base_link">\n  <sensor name="laser_scan" type="ray">\n    <always_on>true</always_on>\n    <update_rate>10</update_rate>\n    <ray>\n      <scan>\n        <horizontal>\n          <samples>360</samples>\n          <resolution>1</resolution>\n          <min_angle>-3.14159</min_angle>\n          <max_angle>3.14159</max_angle>\n        </horizontal>\n      </scan>\n      <range>\n        <min>0.1</min>\n        <max>10.0</max>\n        <resolution>0.01</resolution>\n      </range>\n    </ray>\n    <plugin name="laser_scan_controller" filename="libgazebo_ros_ray_sensor.so">\n      <ros>\n        <namespace>/humanoid_robot</namespace>\n        <remapping>~/out:=scan</remapping>\n      </ros>\n      <output_type>sensor_msgs/LaserScan</output_type>\n      <frame_name>laser_frame</frame_name>\n    </plugin>\n  </sensor>\n</gazebo>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"launch-files-for-integration",children:"Launch Files for Integration"}),"\n",(0,r.jsx)(n.h3,{id:"1-complete-launch-file",children:"1. Complete Launch File"}),"\n",(0,r.jsx)(n.p,{children:"Create a launch file that starts Gazebo with your robot:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# launch/humanoid_gazebo.launch.py\n\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription\nfrom launch.conditions import IfCondition\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n    # Launch arguments\n    use_sim_time = LaunchConfiguration('use_sim_time')\n    robot_name = LaunchConfiguration('robot_name')\n    world = LaunchConfiguration('world')\n\n    # Declare launch arguments\n    declare_use_sim_time = DeclareLaunchArgument(\n        name='use_sim_time',\n        default_value='true',\n        description='Use simulation time'\n    )\n\n    declare_robot_name = DeclareLaunchArgument(\n        name='robot_name',\n        default_value='humanoid_robot',\n        description='Name of the robot'\n    )\n\n    declare_world = DeclareLaunchArgument(\n        name='world',\n        default_value='empty',\n        description='Choose one of: empty, willowgarage, maze'\n    )\n\n    # Start Gazebo\n    gazebo = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('gazebo_ros'),\n                'launch',\n                'gazebo.launch.py'\n            ])\n        ]),\n        launch_arguments={\n            'world': PathJoinSubstitution([\n                FindPackageShare('my_robot_description'),\n                'worlds',\n                world\n            ]),\n            'verbose': 'false',\n        }.items()\n    )\n\n    # Robot State Publisher node\n    robot_state_publisher = Node(\n        package='robot_state_publisher',\n        executable='robot_state_publisher',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'robot_description': PathJoinSubstitution([\n                FindPackageShare('my_robot_description'),\n                'urdf',\n                'humanoid_with_control.urdf'\n            ])\n        }]\n    )\n\n    # Joint State Publisher (for GUI control)\n    joint_state_publisher = Node(\n        package='joint_state_publisher',\n        executable='joint_state_publisher',\n        parameters=[{'use_sim_time': use_sim_time}]\n    )\n\n    # Spawn the robot in Gazebo\n    spawn_robot = Node(\n        package='gazebo_ros',\n        executable='spawn_entity.py',\n        arguments=[\n            '-entity', robot_name,\n            '-topic', 'robot_description',\n            '-x', '0', '-y', '0', '-z', '1.0'\n        ],\n        output='screen'\n    )\n\n    # Load and activate controllers\n    load_joint_state_controller = Node(\n        package='controller_manager',\n        executable='spawner',\n        arguments=['joint_state_broadcaster'],\n        parameters=[{'use_sim_time': use_sim_time}],\n    )\n\n    load_trajectory_controller = Node(\n        package='controller_manager',\n        executable='spawner',\n        arguments=['joint_trajectory_controller'],\n        parameters=[{'use_sim_time': use_sim_time}],\n    )\n\n    return LaunchDescription([\n        declare_use_sim_time,\n        declare_robot_name,\n        declare_world,\n        gazebo,\n        robot_state_publisher,\n        joint_state_publisher,\n        spawn_robot,\n        load_joint_state_controller,\n        load_trajectory_controller,\n    ])\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-controller-spawning-launch-file",children:"2. Controller Spawning Launch File"}),"\n",(0,r.jsx)(n.p,{children:"Create a separate launch file for controller management:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# launch/humanoid_controllers.launch.py\n\nfrom launch import LaunchDescription\nfrom launch.actions import RegisterEventHandler\nfrom launch.event_handlers import OnProcessStart\nfrom launch.substitutions import PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n    # Controller manager\n    controller_manager = Node(\n        package='controller_manager',\n        executable='ros2_control_node',\n        parameters=[\n            PathJoinSubstitution([\n                FindPackageShare('my_robot_description'),\n                'config',\n                'humanoid_control.yaml'\n            ])\n        ],\n        output='both',\n    )\n\n    # Joint state broadcaster\n    joint_state_broadcaster_spawner = Node(\n        package='controller_manager',\n        executable='spawner',\n        arguments=['joint_state_broadcaster'],\n        output='both',\n    )\n\n    # Joint trajectory controller\n    joint_trajectory_controller_spawner = Node(\n        package='controller_manager',\n        executable='spawner',\n        arguments=['joint_trajectory_controller'],\n        output='both',\n    )\n\n    # Set up event handler to start controllers after controller manager starts\n    delay_joint_state_broadcaster_spawner_after_controller_manager = RegisterEventHandler(\n        event_handler=OnProcessStart(\n            target_action=controller_manager,\n            on_start=[\n                joint_state_broadcaster_spawner,\n            ],\n        )\n    )\n\n    delay_joint_trajectory_controller_spawner_after_joint_state_broadcaster = RegisterEventHandler(\n        event_handler=OnProcessStart(\n            target_action=joint_state_broadcaster_spawner,\n            on_start=[\n                joint_trajectory_controller_spawner,\n            ],\n        )\n    )\n\n    return LaunchDescription([\n        controller_manager,\n        delay_joint_state_broadcaster_spawner_after_controller_manager,\n        delay_joint_trajectory_controller_spawner_after_joint_state_broadcaster,\n    ])\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing-the-integration",children:"Testing the Integration"}),"\n",(0,r.jsx)(n.h3,{id:"1-basic-integration-test",children:"1. Basic Integration Test"}),"\n",(0,r.jsx)(n.p,{children:"Create a simple test script to verify the integration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# test/gazebo_integration_test.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState, Imu\nfrom trajectory_msgs.msg import JointTrajectory, JointTrajectoryPoint\nfrom control_msgs.msg import JointTrajectoryControllerState\nfrom builtin_interfaces.msg import Duration\nimport time\n\nclass GazeboIntegrationTest(Node):\n    def __init__(self):\n        super().__init__('gazebo_integration_test')\n\n        # Subscriptions\n        self.joint_state_sub = self.create_subscription(\n            JointState, '/humanoid_robot/joint_states', self.joint_state_callback, 10)\n\n        self.imu_sub = self.create_subscription(\n            Imu, '/humanoid_robot/imu/data', self.imu_callback, 10)\n\n        # Publishers\n        self.trajectory_pub = self.create_publisher(\n            JointTrajectory, '/humanoid_robot/joint_trajectory_controller/joint_trajectory', 10)\n\n        self.controller_state_sub = self.create_subscription(\n            JointTrajectoryControllerState,\n            '/humanoid_robot/joint_trajectory_controller/state',\n            self.controller_state_callback, 10)\n\n        # Test timer\n        self.test_timer = self.create_timer(5.0, self.run_integration_test)\n\n        self.joint_states_received = False\n        self.imu_data_received = False\n        self.test_step = 0\n\n        self.get_logger().info('Gazebo integration test node initialized')\n\n    def joint_state_callback(self, msg):\n        if not self.joint_states_received:\n            self.get_logger().info(f'\u2713 Joint states received: {len(msg.name)} joints')\n            self.joint_states_received = True\n\n    def imu_callback(self, msg):\n        if not self.imu_data_received:\n            self.get_logger().info('\u2713 IMU data received from simulation')\n            self.imu_data_received = True\n\n    def controller_state_callback(self, msg):\n        self.get_logger().debug('Controller state received')\n\n    def run_integration_test(self):\n        if self.test_step == 0:\n            self.get_logger().info('Step 1: Verifying sensor data flow...')\n            self.test_step += 1\n        elif self.test_step == 1:\n            self.get_logger().info('Step 2: Sending trajectory command...')\n            self.send_test_trajectory()\n            self.test_step += 1\n        elif self.test_step == 2:\n            self.get_logger().info('Step 3: Verifying actuator response...')\n            self.test_step += 1\n        elif self.test_step == 3:\n            self.get_logger().info('Integration test completed!')\n            self.test_timer.cancel()\n            self.get_logger().info('\u2713 Gazebo-ROS integration appears to be working correctly')\n\n    def send_test_trajectory(self):\n        \"\"\"Send a simple trajectory command to test actuator control\"\"\"\n        msg = JointTrajectory()\n        msg.joint_names = ['left_shoulder_pitch_joint', 'right_shoulder_pitch_joint']\n\n        point = JointTrajectoryPoint()\n        point.positions = [0.5, 0.5]  # Move both shoulders up\n        point.velocities = [0.1, 0.1]\n        point.time_from_start = Duration(sec=2, nanosec=0)\n\n        msg.points.append(point)\n        msg.header.stamp = self.get_clock().now().to_msg()\n\n        self.trajectory_pub.publish(msg)\n        self.get_logger().info('Trajectory command published')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = GazeboIntegrationTest()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Integration test interrupted')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-advanced-control-test",children:"2. Advanced Control Test"}),"\n",(0,r.jsx)(n.p,{children:"Create a more comprehensive test that validates control performance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# test/control_performance_test.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom trajectory_msgs.msg import JointTrajectory, JointTrajectoryPoint\nfrom control_msgs.msg import JointTrajectoryControllerState\nfrom builtin_interfaces.msg import Duration\nimport numpy as np\nimport time\n\nclass ControlPerformanceTest(Node):\n    def __init__(self):\n        super().__init__('control_performance_test')\n\n        # Subscriptions\n        self.joint_state_sub = self.create_subscription(\n            JointState, '/humanoid_robot/joint_states', self.joint_state_callback, 10)\n\n        self.controller_state_sub = self.create_subscription(\n            JointTrajectoryControllerState,\n            '/humanoid_robot/joint_trajectory_controller/state',\n            self.controller_state_callback, 10)\n\n        # Publishers\n        self.trajectory_pub = self.create_publisher(\n            JointTrajectory, '/humanoid_robot/joint_trajectory_controller/joint_trajectory', 10)\n\n        # Test parameters\n        self.test_joints = ['left_knee_joint', 'right_knee_joint']\n        self.current_positions = {}\n        self.target_positions = {}\n        self.test_active = False\n        self.test_start_time = None\n        self.test_results = []\n\n        # Performance metrics\n        self.position_errors = []\n        self.response_times = []\n\n        self.get_logger().info('Control performance test initialized')\n\n    def joint_state_callback(self, msg):\n        for i, name in enumerate(msg.name):\n            if name in self.test_joints:\n                self.current_positions[name] = msg.position[i]\n\n    def controller_state_callback(self, msg):\n        if self.test_active and self.test_start_time:\n            current_time = self.get_clock().now().nanoseconds * 1e-9\n\n            # Calculate position errors\n            for i, joint_name in enumerate(msg.joint_names):\n                if joint_name in self.test_joints:\n                    actual_pos = msg.feedback.positions[i] if msg.feedback.positions else 0.0\n                    desired_pos = msg.desired.positions[i] if msg.desired.positions else 0.0\n                    error = abs(actual_pos - desired_pos)\n                    self.position_errors.append(error)\n\n    def start_performance_test(self):\n        \"\"\"Start a performance test with step inputs\"\"\"\n        self.get_logger().info('Starting control performance test...')\n\n        # Send step command\n        msg = JointTrajectory()\n        msg.joint_names = self.test_joints\n\n        point = JointTrajectoryPoint()\n        # Move knees from 0 to 0.5 radians\n        point.positions = [0.5, 0.5]\n        point.velocities = [0.2, 0.2]  # Reasonable velocity\n        point.time_from_start = Duration(sec=3, nanosec=0)\n\n        msg.points.append(point)\n        msg.header.stamp = self.get_clock().now().to_msg()\n\n        self.trajectory_pub.publish(msg)\n        self.test_active = True\n        self.test_start_time = self.get_clock().now().nanoseconds * 1e-9\n\n        self.get_logger().info(f'Step command sent: {self.test_joints} -> [0.5, 0.5]')\n\n        # Schedule test completion check\n        self.create_timer(5.0, self.check_test_completion)\n\n    def check_test_completion(self):\n        \"\"\"Check if the test has completed and evaluate performance\"\"\"\n        if not self.position_errors:\n            self.get_logger().warn('No position error data collected')\n            return\n\n        avg_error = np.mean(self.position_errors)\n        max_error = np.max(self.position_errors)\n        std_error = np.std(self.position_errors)\n\n        self.get_logger().info(f'Control Performance Results:')\n        self.get_logger().info(f'  Average Position Error: {avg_error:.4f} rad')\n        self.get_logger().info(f'  Max Position Error: {max_error:.4f} rad')\n        self.get_logger().info(f'  Std Dev Position Error: {std_error:.4f} rad')\n\n        # Evaluate performance\n        if avg_error < 0.05:\n            self.get_logger().info('\u2713 Control performance is EXCELLENT')\n        elif avg_error < 0.1:\n            self.get_logger().info('\u2713 Control performance is GOOD')\n        elif avg_error < 0.2:\n            self.get_logger().info('\u26a0 Control performance is ACCEPTABLE')\n        else:\n            self.get_logger().warn('\u26a0 Control performance needs improvement')\n\n        self.test_active = False\n        self.position_errors = []  # Reset for next test\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ControlPerformanceTest()\n\n    # Start test after a brief delay to allow systems to initialize\n    node.create_timer(3.0, node.start_performance_test)\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Performance test interrupted')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-common-integration-issues",children:"Troubleshooting Common Integration Issues"}),"\n",(0,r.jsx)(n.h3,{id:"1-controller-loading-issues",children:"1. Controller Loading Issues"}),"\n",(0,r.jsx)(n.p,{children:"If controllers fail to load, check these common issues:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if controller manager is running\nros2 node list | grep controller_manager\n\n# Check controller status\nros2 control list_controllers\n\n# Load a specific controller manually\nros2 run controller_manager spawner joint_state_broadcaster\n\n# Check parameter configurations\nros2 param list\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-tf-tree-issues",children:"2. TF Tree Issues"}),"\n",(0,r.jsx)(n.p,{children:"Verify the transform tree is properly maintained:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check TF tree\nros2 run tf2_tools view_frames\n\n# Echo transforms\nros2 run tf2_ros tf2_echo base_link left_foot_link\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-sensor-data-issues",children:"3. Sensor Data Issues"}),"\n",(0,r.jsx)(n.p,{children:"Debug sensor data flow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check if sensor topics are being published\nros2 topic list | grep -E "(imu|scan|camera)"\n\n# Echo sensor data\nros2 topic echo /humanoid_robot/imu/data\nros2 topic echo /humanoid_robot/scan\n'})}),"\n",(0,r.jsx)(n.h2,{id:"advanced-integration-features",children:"Advanced Integration Features"}),"\n",(0,r.jsx)(n.h3,{id:"1-gazebo-services",children:"1. Gazebo Services"}),"\n",(0,r.jsx)(n.p,{children:"Use Gazebo services for simulation control:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Advanced simulation control\nimport rclpy\nfrom rclpy.node import Node\nfrom gazebo_msgs.srv import SetEntityState, GetEntityState, SpawnEntity, DeleteEntity\n\nclass AdvancedSimulationControl(Node):\n    def __init__(self):\n        super().__init__('advanced_sim_control')\n\n        # Create clients for Gazebo services\n        self.set_state_client = self.create_client(\n            SetEntityState, '/world/default/set_entity_state')\n        self.get_state_client = self.create_client(\n            GetEntityState, '/world/default/get_entity_state')\n\n        # Wait for services to be available\n        while not self.set_state_client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Set state service not available, waiting...')\n\n        while not self.get_state_client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Get state service not available, waiting...')\n\n    def reset_robot_position(self, x=0.0, y=0.0, z=1.0):\n        \"\"\"Reset robot to specific position\"\"\"\n        from gazebo_msgs.msg import EntityState\n        from geometry_msgs.msg import Pose, Twist\n\n        req = SetEntityState.Request()\n        req.state = EntityState()\n        req.state.name = 'humanoid_robot'\n        req.state.pose = Pose()\n        req.state.pose.position.x = x\n        req.state.pose.position.y = y\n        req.state.pose.position.z = z\n        req.state.pose.orientation.w = 1.0  # No rotation\n        req.state.twist = Twist()  # No velocity\n\n        future = self.set_state_client.call_async(req)\n        # Handle response asynchronously\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"1-efficient-update-rates",children:"1. Efficient Update Rates"}),"\n",(0,r.jsx)(n.p,{children:"Setting appropriate update rates for different components:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'\x3c!-- High frequency for critical sensors (IMU, joint states) --\x3e\n<plugin name="high_freq_imu" filename="libgazebo_ros_imu.so">\n  <update_rate>1000</update_rate> \x3c!-- 1kHz for balance control --\x3e\n  \x3c!-- ... --\x3e\n</plugin>\n\n\x3c!-- Medium frequency for cameras and LiDAR --\x3e\n<plugin name="camera_controller" filename="libgazebo_ros_camera.so">\n  <update_rate>30</update_rate> \x3c!-- 30Hz for vision processing --\x3e\n  \x3c!-- ... --\x3e\n</plugin>\n\n\x3c!-- Lower frequency for less critical sensors --\x3e\n<plugin name="gps_controller" filename="libgazebo_ros_gps.so">\n  <update_rate>10</update_rate> \x3c!-- 10Hz for navigation --\x3e\n  \x3c!-- ... --\x3e\n</plugin>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-threading-configuration",children:"2. Threading Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Optimizing thread usage for better performance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'\x3c!-- In your world file --\x3e\n<world name="humanoid_world">\n  \x3c!-- Physics configuration for optimal performance --\x3e\n  <physics type="ode">\n    <max_step_size>0.001</max_step_size> \x3c!-- 1ms time step --\x3e\n    <real_time_factor>1.0</real_time_factor>\n    <real_time_update_rate>1000.0</real_time_update_rate>\n    <ode>\n      <solver>\n        <type>quick</type></solver>\n      <iters>100</iters> \x3c!-- Balance between accuracy and performance --\x3e\n      <sor>1.3</sor>\n    </ode>\n    <constraints>\n      <cfm>0.000001</cfm>\n      <erp>0.2</erp>\n    </constraints>\n  </physics>\n\n  \x3c!-- Your robot and plugins --\x3e\n  \x3c!-- ... --\x3e\n</world>\n'})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,r.jsx)(n.h3,{id:"1-communication-problems",children:"1. Communication Problems"}),"\n",(0,r.jsx)(n.p,{children:"Common issues and solutions:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Problem: Joint states not being published"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify plugin is loaded: ",(0,r.jsx)(n.code,{children:"gz topic -l | grep joint_states"})]}),"\n",(0,r.jsx)(n.li,{children:"Check namespace configuration in plugin"}),"\n",(0,r.jsx)(n.li,{children:"Ensure robot model is properly loaded in Gazebo"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Problem: Control commands not reaching joints"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify topic names match between controller and plugin"}),"\n",(0,r.jsxs)(n.li,{children:["Check that controller is loaded and running: ",(0,r.jsx)(n.code,{children:"ros2 control list_controllers"})]}),"\n",(0,r.jsx)(n.li,{children:"Ensure proper QoS settings between publisher and subscriber"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Problem: TF tree not publishing properly"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify robot state publisher is running"}),"\n",(0,r.jsx)(n.li,{children:"Check that joint states are being published"}),"\n",(0,r.jsx)(n.li,{children:"Ensure proper frame names in URDF/SDF"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-performance-issues",children:"2. Performance Issues"}),"\n",(0,r.jsx)(n.p,{children:"Optimizing for better performance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reduce sensor update rates for non-critical sensors"}),"\n",(0,r.jsx)(n.li,{children:"Use lower resolution for cameras when possible"}),"\n",(0,r.jsx)(n.li,{children:"Optimize physics parameters for your specific use case"}),"\n",(0,r.jsx)(n.li,{children:"Consider using simpler collision geometries"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"testing-and-validation",children:"Testing and Validation"}),"\n",(0,r.jsx)(n.h3,{id:"1-communication-validation-script",children:"1. Communication Validation Script"}),"\n",(0,r.jsx)(n.p,{children:"Testing the Gazebo-ROS integration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n# test_gazebo_ros_integration.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState, Imu\nfrom geometry_msgs.msg import Twist\nfrom trajectory_msgs.msg import JointTrajectory, JointTrajectoryPoint\nimport time\n\nclass GazeboROSIntegrationTester(Node):\n    def __init__(self):\n        super().__init__('gazebo_ros_integration_tester')\n\n        # Publishers\n        self.joint_cmd_pub = self.create_publisher(\n            JointTrajectory, '/humanoid_controller/joint_trajectory', 10)\n\n        # Subscribers\n        self.joint_state_sub = self.create_subscription(\n            JointState, '/joint_states', self.joint_state_callback, 10)\n        self.imu_sub = self.create_subscription(\n            Imu, '/imu/data', self.imu_callback, 10)\n\n        # Flags to track if we're receiving data\n        self.joint_states_received = False\n        self.imu_data_received = False\n\n        # Timer for periodic checks\n        self.timer = self.create_timer(1.0, self.periodic_check)\n\n        self.get_logger().info('Gazebo-ROS integration tester initialized')\n\n    def joint_state_callback(self, msg):\n        self.joint_states_received = True\n        if len(msg.name) > 0:\n            self.get_logger().debug(f'Received joint states for {len(msg.name)} joints')\n\n    def imu_callback(self, msg):\n        self.imu_data_received = True\n        self.get_logger().debug('Received IMU data')\n\n    def periodic_check(self):\n        if self.joint_states_received and self.imu_data_received:\n            self.get_logger().info('\u2713 Gazebo-ROS integration is working correctly')\n        else:\n            status = []\n            if not self.joint_states_received:\n                status.append('No joint states received')\n            if not self.imu_data_received:\n                status.append('No IMU data received')\n            self.get_logger().warn(f'\u2717 Integration issues: {\", \".join(status)}')\n\n        # Send a simple test command to verify control path\n        self.send_test_command()\n\n    def send_test_command(self):\n        # Send a simple joint trajectory command\n        traj_msg = JointTrajectory()\n        traj_msg.joint_names = ['left_hip_joint']  # Example joint\n\n        point = JointTrajectoryPoint()\n        point.positions = [0.1]  # Move to 0.1 radians\n        point.time_from_start.sec = 1\n        point.time_from_start.nanosec = 0\n\n        traj_msg.points = [point]\n\n        self.joint_cmd_pub.publish(traj_msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    tester = GazeboROSIntegrationTester()\n\n    try:\n        rclpy.spin(tester)\n    except KeyboardInterrupt:\n        tester.get_logger().info('Integration tester shutting down')\n    finally:\n        tester.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"With Gazebo-ROS integration properly configured, you now have a complete digital twin system for humanoid robots. The integration enables seamless communication between simulation and control systems, allowing for realistic testing and development of humanoid robot applications."}),"\n",(0,r.jsx)(n.p,{children:"In the next section, we'll explore sensor simulation in Gazebo, covering how to configure realistic sensors for your humanoid robot including cameras, LiDAR, IMU, and force/torque sensors."})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(_,{...e})}):_(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var o=t(6540);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);