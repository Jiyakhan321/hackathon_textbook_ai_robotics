"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[6492],{1922:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module-2-digital-twin/unity-simulation/unity-robotics-setup","title":"Unity Robotics Setup and Configuration","description":"Overview","source":"@site/docs/module-2-digital-twin/unity-simulation/unity-robotics-setup.md","sourceDirName":"module-2-digital-twin/unity-simulation","slug":"/module-2-digital-twin/unity-simulation/unity-robotics-setup","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-robotics-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics/tree/main/docs/module-2-digital-twin/unity-simulation/unity-robotics-setup.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Sensor Simulation in Gazebo","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/gazebo-simulation/sensor-simulation"},"next":{"title":"Environment Creation for Humanoid Robots in Unity","permalink":"/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/environment-creation"}}');var o=i(4848),s=i(8453);const r={sidebar_position:1},a="Unity Robotics Setup and Configuration",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites and Requirements",id:"prerequisites-and-requirements",level:2},{value:"System Requirements",id:"system-requirements",level:3},{value:"Required Software",id:"required-software",level:3},{value:"Installing Unity Robotics Hub",id:"installing-unity-robotics-hub",level:2},{value:"1. Install Unity Hub and Unity Editor",id:"1-install-unity-hub-and-unity-editor",level:3},{value:"2. Create a New Unity Project",id:"2-create-a-new-unity-project",level:3},{value:"3. Install Unity Robotics Hub",id:"3-install-unity-robotics-hub",level:3},{value:"Basic Unity Robotics Setup",id:"basic-unity-robotics-setup",level:2},{value:"1. Configure ROS Settings",id:"1-configure-ros-settings",level:3},{value:"2. Set Up the Unity Scene",id:"2-set-up-the-unity-scene",level:3},{value:"3. Create Humanoid Robot Components",id:"3-create-humanoid-robot-components",level:3},{value:"4. Configure Articulation Bodies for Joints",id:"4-configure-articulation-bodies-for-joints",level:3},{value:"Setting Up Sensors in Unity",id:"setting-up-sensors-in-unity",level:2},{value:"1. Camera Sensor Setup",id:"1-camera-sensor-setup",level:3},{value:"2. IMU Sensor Setup",id:"2-imu-sensor-setup",level:3},{value:"ROS 2 Bridge Configuration",id:"ros-2-bridge-configuration",level:2},{value:"1. Setting up the ROS-TCP-Endpoint",id:"1-setting-up-the-ros-tcp-endpoint",level:3},{value:"2. Launch File for Unity Integration",id:"2-launch-file-for-unity-integration",level:3},{value:"Testing the Unity Setup",id:"testing-the-unity-setup",level:2},{value:"1. Basic Connection Test",id:"1-basic-connection-test",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"1. Unity Physics Optimization",id:"1-unity-physics-optimization",level:3},{value:"2. Graphics Optimization",id:"2-graphics-optimization",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"unity-robotics-setup-and-configuration",children:"Unity Robotics Setup and Configuration"})}),"\n",(0,o.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(e.p,{children:"Unity provides a powerful platform for creating sophisticated simulation environments for humanoid robots, particularly when advanced graphics, physics, or AI training are required. The Unity Robotics Hub provides the bridge between Unity and ROS 2, enabling your humanoid robot to interact with the ROS 2 ecosystem. This section covers setting up Unity for robotics applications."}),"\n",(0,o.jsx)(e.h2,{id:"prerequisites-and-requirements",children:"Prerequisites and Requirements"}),"\n",(0,o.jsx)(e.h3,{id:"system-requirements",children:"System Requirements"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Operating System"}),": Windows 10/11, Ubuntu 20.04/22.04, or macOS 10.14+"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Unity Version"}),": Unity 2022.3 LTS (recommended for stability)"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"Hardware"}),":","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"GPU with DirectX 11 or OpenGL 4.3 support"}),"\n",(0,o.jsx)(e.li,{children:"8GB+ RAM recommended for complex humanoid simulations"}),"\n",(0,o.jsx)(e.li,{children:"Multi-core processor for physics simulation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"required-software",children:"Required Software"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Unity Hub (for version management)"}),"\n",(0,o.jsx)(e.li,{children:"Unity 2022.3 LTS with Linux Build Support (if using ROS 2 on Linux)"}),"\n",(0,o.jsx)(e.li,{children:"ROS 2 Humble Hawksbill"}),"\n",(0,o.jsx)(e.li,{children:"Unity Robotics Hub package"}),"\n",(0,o.jsx)(e.li,{children:"Unity ML-Agents (for AI training)"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"installing-unity-robotics-hub",children:"Installing Unity Robotics Hub"}),"\n",(0,o.jsx)(e.h3,{id:"1-install-unity-hub-and-unity-editor",children:"1. Install Unity Hub and Unity Editor"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["Download and install Unity Hub from ",(0,o.jsx)(e.a,{href:"https://unity.com/",children:"Unity's website"})]}),"\n",(0,o.jsx)(e.li,{children:"Through Unity Hub, install Unity 2022.3 LTS"}),"\n",(0,o.jsxs)(e.li,{children:["When installing, make sure to include:","\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Linux Build Support (if using ROS 2 on Linux)"}),"\n",(0,o.jsx)(e.li,{children:"Windows Build Support (for Windows users)"}),"\n",(0,o.jsx)(e.li,{children:"macOS Build Support (for macOS users)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"2-create-a-new-unity-project",children:"2. Create a New Unity Project"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"Open Unity Hub"}),"\n",(0,o.jsx)(e.li,{children:'Click "New Project"'}),"\n",(0,o.jsx)(e.li,{children:'Select the "3D (Built-in Render Pipeline)" template (not URP/HDRP for beginners)'}),"\n",(0,o.jsx)(e.li,{children:'Name your project (e.g., "HumanoidRobotSimulation")'}),"\n",(0,o.jsx)(e.li,{children:'Choose a location and click "Create"'}),"\n"]}),"\n",(0,o.jsx)(e.h3,{id:"3-install-unity-robotics-hub",children:"3. Install Unity Robotics Hub"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsx)(e.li,{children:"In Unity, open the Package Manager (Window > Package Manager)"}),"\n",(0,o.jsx)(e.li,{children:'Click the "+" button in the top-left corner'}),"\n",(0,o.jsx)(e.li,{children:'Select "Add package from git URL..."'}),"\n",(0,o.jsxs)(e.li,{children:["Enter the URL: ",(0,o.jsx)(e.code,{children:"https://github.com/Unity-Technologies/Unity-Robotics-Hub.git"})]}),"\n",(0,o.jsx)(e.li,{children:'Click "Add"'}),"\n"]}),"\n",(0,o.jsx)(e.p,{children:"Alternatively, you can install specific packages:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"ROS-TCP-Connector"}),": For ROS 2 communication"]}),"\n",(0,o.jsxs)(e.li,{children:[(0,o.jsx)(e.strong,{children:"ROS-TCP-Endpoint"}),": For ROS 2 endpoint management"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"basic-unity-robotics-setup",children:"Basic Unity Robotics Setup"}),"\n",(0,o.jsx)(e.h3,{id:"1-configure-ros-settings",children:"1. Configure ROS Settings"}),"\n",(0,o.jsx)(e.p,{children:"First, let's set up the basic ROS communication in your Unity scene:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// Create a new C# script: ROSConnectionManager.cs\n\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\n\npublic class ROSConnectionManager : MonoBehaviour\n{\n    [Header("ROS Connection Settings")]\n    public string rosIPAddress = "127.0.0.1";  // ROS master IP address\n    public int rosPort = 10000;                 // ROS TCP port\n\n    private RosConnection m_RosConnection;\n\n    void Start()\n    {\n        // Get or create the ROS connection instance\n        m_RosConnection = RosConnection.instance;\n\n        if (m_RosConnection != null)\n        {\n            // Connect to ROS\n            m_RosConnection.rosIPAddress = rosIPAddress;\n            m_RosConnection.rosPort = rosPort;\n\n            Debug.Log($"Connecting to ROS at {rosIPAddress}:{rosPort}");\n        }\n        else\n        {\n            Debug.LogError("Failed to get ROS connection instance!");\n        }\n    }\n\n    // Example method to send a message to ROS\n    public void SendTestMessage()\n    {\n        if (m_RosConnection != null)\n        {\n            // Publish a simple string message to a test topic\n            m_RosConnection.Publish("unity_test_topic", new Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg\n            {\n                data = "Hello from Unity!"\n            });\n        }\n    }\n\n    // Example method to subscribe to a ROS topic\n    public void SubscribeToTopic()\n    {\n        if (m_RosConnection != null)\n        {\n            m_RosConnection.Subscribe<Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg>(\n                "robot_commands",\n                OnRobotCommandReceived\n            );\n        }\n    }\n\n    void OnRobotCommandReceived(Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg msg)\n    {\n        Debug.Log($"Received command from ROS: {msg.data}");\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"2-set-up-the-unity-scene",children:"2. Set Up the Unity Scene"}),"\n",(0,o.jsx)(e.p,{children:"Create a basic scene structure for your humanoid robot:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{children:"Scene Hierarchy:\n\u251c\u2500\u2500 ROSConnectionManager (with ROSConnectionManager.cs)\n\u251c\u2500\u2500 RobotEnvironment\n\u2502   \u251c\u2500\u2500 GroundPlane\n\u2502   \u251c\u2500\u2500 Lighting\n\u2502   \u2514\u2500\u2500 Obstacles\n\u251c\u2500\u2500 HumanoidRobot\n\u2502   \u251c\u2500\u2500 RobotBase (Rigidbody)\n\u2502   \u251c\u2500\u2500 Torso\n\u2502   \u251c\u2500\u2500 Head\n\u2502   \u251c\u2500\u2500 LeftArm\n\u2502   \u2502   \u251c\u2500\u2500 Shoulder\n\u2502   \u2502   \u251c\u2500\u2500 Elbow\n\u2502   \u2502   \u2514\u2500\u2500 Hand\n\u2502   \u251c\u2500\u2500 RightArm\n\u2502   \u2502   \u251c\u2500\u2500 Shoulder\n\u2502   \u2502   \u251c\u2500\u2500 Elbow\n\u2502   \u2502   \u2514\u2500\u2500 Hand\n\u2502   \u251c\u2500\u2500 LeftLeg\n\u2502   \u2502   \u251c\u2500\u2500 Hip\n\u2502   \u2502   \u251c\u2500\u2500 Knee\n\u2502   \u2502   \u2514\u2500\u2500 Foot\n\u2502   \u2514\u2500\u2500 RightLeg\n\u2502       \u251c\u2500\u2500 Hip\n\u2502       \u251c\u2500\u2500 Knee\n\u2502       \u2514\u2500\u2500 Foot\n\u2514\u2500\u2500 Sensors\n    \u251c\u2500\u2500 Camera\n    \u251c\u2500\u2500 IMU\n    \u2514\u2500\u2500 LiDAR\n"})}),"\n",(0,o.jsx)(e.h3,{id:"3-create-humanoid-robot-components",children:"3. Create Humanoid Robot Components"}),"\n",(0,o.jsx)(e.p,{children:"Let's create a basic humanoid robot structure:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// HumanoidRobotController.cs - Main robot controller script\n\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor_msgs;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry_msgs;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs;\n\npublic class HumanoidRobotController : MonoBehaviour\n{\n    [Header("Joint Configuration")]\n    public Transform[] jointTransforms;\n    public ArticulationBody[] jointArticulationBodies;\n\n    [Header("ROS Topics")]\n    public string jointStateTopic = "/joint_states";\n    public string jointCommandTopic = "/joint_commands";\n\n    [Header("Robot Parameters")]\n    public float maxJointVelocity = 5.0f;\n    public float jointForceLimit = 100.0f;\n\n    private RosConnection m_RosConnection;\n    private float lastPublishTime;\n    private const float publishInterval = 0.05f; // 20 Hz\n\n    void Start()\n    {\n        m_RosConnection = RosConnection.instance;\n\n        // Subscribe to joint commands\n        if (m_RosConnection != null)\n        {\n            m_RosConnection.Subscribe<Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor_msgs.JointStateMsg>(\n                jointCommandTopic, OnJointCommandReceived);\n        }\n\n        // Initialize joint transforms array\n        InitializeJointArrays();\n    }\n\n    void InitializeJointArrays()\n    {\n        // Find all ArticulationBody components in children\n        jointArticulationBodies = GetComponentsInChildren<ArticulationBody>();\n\n        // Create transforms array for easier access\n        jointTransforms = new Transform[jointArticulationBodies.Length];\n        for (int i = 0; i < jointArticulationBodies.Length; i++)\n        {\n            jointTransforms[i] = jointArticulationBodies[i].transform;\n        }\n    }\n\n    void Update()\n    {\n        // Publish joint states at regular intervals\n        if (Time.time - lastPublishTime > publishInterval)\n        {\n            PublishJointStates();\n            lastPublishTime = Time.time;\n        }\n    }\n\n    void OnJointCommandReceived(JointStateMsg msg)\n    {\n        // Process joint commands from ROS\n        for (int i = 0; i < msg.name.Count; i++)\n        {\n            string jointName = msg.name[i];\n\n            // Find the corresponding joint in our robot\n            ArticulationBody joint = FindJointByName(jointName);\n            if (joint != null && i < msg.position.Count)\n            {\n                SetJointTargetPosition(joint, msg.position[i]);\n            }\n        }\n    }\n\n    ArticulationBody FindJointByName(string name)\n    {\n        foreach (ArticulationBody joint in jointArticulationBodies)\n        {\n            if (joint.name == name || joint.name.ToLower().Contains(name.ToLower()))\n            {\n                return joint;\n            }\n        }\n        return null;\n    }\n\n    void SetJointTargetPosition(ArticulationBody joint, double targetPosition)\n    {\n        ArticulationDrive drive = joint.xDrive;\n        drive.target = (float)targetPosition;\n        drive.forceLimit = jointForceLimit;\n        drive.damping = 10f; // Adjust based on your robot\'s requirements\n        drive.stiffness = 100f;\n        joint.xDrive = drive;\n    }\n\n    void PublishJointStates()\n    {\n        if (m_RosConnection == null) return;\n\n        // Create joint state message\n        JointStateMsg jointStateMsg = new JointStateMsg();\n        jointStateMsg.name = new System.Collections.Generic.List<string>();\n        jointStateMsg.position = new System.Collections.Generic.List<double>();\n        jointStateMsg.velocity = new System.Collections.Generic.List<double>();\n        jointStateMsg.effort = new System.Collections.Generic.List<double>();\n\n        // Populate with current joint states\n        foreach (ArticulationBody joint in jointArticulationBodies)\n        {\n            jointStateMsg.name.Add(joint.name);\n            jointStateMsg.position.Add(joint.jointPosition[0]);\n            jointStateMsg.velocity.Add(joint.jointVelocity[0]);\n            jointStateMsg.effort.Add(joint.jointForce[0]);\n        }\n\n        // Set timestamp\n        jointStateMsg.header = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.HeaderMsg\n        {\n            stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.Builtin_interfaces.TimeMsg\n            {\n                sec = (int)Time.time,\n                nanosec = (uint)((Time.time % 1) * 1e9)\n            },\n            frame_id = "base_link"\n        };\n\n        m_RosConnection.Publish(jointStateTopic, jointStateMsg);\n    }\n\n    // Helper method to set robot to a specific pose\n    public void SetRobotPose(Vector3 position, Quaternion rotation)\n    {\n        transform.position = position;\n        transform.rotation = rotation;\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"4-configure-articulation-bodies-for-joints",children:"4. Configure Articulation Bodies for Joints"}),"\n",(0,o.jsx)(e.p,{children:"Unity uses ArticulationBody components to simulate robot joints. Here's how to configure them:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// JointConfigurationHelper.cs - Helper script for joint configuration\n\nusing UnityEngine;\n\npublic class JointConfigurationHelper : MonoBehaviour\n{\n    [Header("Joint Configuration")]\n    public ArticulationBody joint;\n    public JointType jointType = JointType.RevoluteJoint;\n\n    [Header("Joint Limits")]\n    public float lowerLimit = -45f;\n    public float upperLimit = 45f;\n    public float stiffness = 100f;\n    public float damping = 10f;\n    public float forceLimit = 100f;\n\n    [Header("Drive Settings")]\n    public bool useDrive = true;\n    public float driveForceLimit = 50f;\n    public float driveDamping = 10f;\n    public float driveStiffness = 100f;\n\n    [ContextMenu("Configure Joint")]\n    public void ConfigureJoint()\n    {\n        if (joint == null)\n        {\n            joint = GetComponent<ArticulationBody>();\n            if (joint == null)\n            {\n                Debug.LogError("No ArticulationBody found on this object!");\n                return;\n            }\n        }\n\n        // Set joint type\n        joint.jointType = jointType;\n\n        // Configure joint drive\n        if (useDrive)\n        {\n            ArticulationDrive drive = joint.xDrive;\n            drive.forceLimit = driveForceLimit;\n            drive.damping = driveDamping;\n            drive.stiffness = driveStiffness;\n            drive.upperLimit = upperLimit;\n            drive.lowerLimit = lowerLimit;\n            joint.xDrive = drive;\n        }\n\n        // Set joint limits based on type\n        switch (jointType)\n        {\n            case JointType.RevoluteJoint:\n            case JointType.ContinuousJoint:\n                ArticulationDrive xDrive = joint.xDrive;\n                if (jointType == JointType.RevoluteJoint)\n                {\n                    xDrive.upperLimit = upperLimit;\n                    xDrive.lowerLimit = lowerLimit;\n                }\n                xDrive.stiffness = stiffness;\n                xDrive.damping = damping;\n                xDrive.forceLimit = forceLimit;\n                joint.xDrive = xDrive;\n                break;\n\n            case JointType.PrismaticJoint:\n                ArticulationDrive zDrive = joint.zDrive;\n                zDrive.upperLimit = upperLimit;\n                zDrive.lowerLimit = lowerLimit;\n                zDrive.stiffness = stiffness;\n                zDrive.damping = damping;\n                zDrive.forceLimit = forceLimit;\n                joint.zDrive = zDrive;\n                break;\n        }\n\n        Debug.Log($"Joint {gameObject.name} configured with type: {jointType}");\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"setting-up-sensors-in-unity",children:"Setting Up Sensors in Unity"}),"\n",(0,o.jsx)(e.h3,{id:"1-camera-sensor-setup",children:"1. Camera Sensor Setup"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// UnityCameraSensor.cs - Camera sensor for ROS\n\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor_msgs;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs;\nusing System.Collections;\n\npublic class UnityCameraSensor : MonoBehaviour\n{\n    [Header("Camera Settings")]\n    public Camera cameraComponent;\n    public string imageTopic = "/camera/image_raw";\n    public string infoTopic = "/camera/camera_info";\n    public int imageWidth = 640;\n    public int imageHeight = 480;\n    public float publishRate = 30f; // Hz\n\n    [Header("Camera Intrinsics")]\n    public float fov = 60f; // Field of view in degrees\n    public float nearClip = 0.1f;\n    public float farClip = 100f;\n\n    private RosConnection m_RosConnection;\n    private RenderTexture renderTexture;\n    private Texture2D texture2D;\n    private float lastPublishTime;\n\n    void Start()\n    {\n        m_RosConnection = RosConnection.instance;\n\n        if (cameraComponent == null)\n            cameraComponent = GetComponent<Camera>();\n\n        // Create render texture for camera capture\n        renderTexture = new RenderTexture(imageWidth, imageHeight, 24);\n        cameraComponent.targetTexture = renderTexture;\n\n        // Create texture for reading pixels\n        texture2D = new Texture2D(imageWidth, imageHeight, TextureFormat.RGB24, false);\n\n        // Set camera parameters\n        cameraComponent.fieldOfView = fov;\n        cameraComponent.nearClipPlane = nearClip;\n        cameraComponent.farClipPlane = farClip;\n    }\n\n    void Update()\n    {\n        if (m_RosConnection != null && Time.time - lastPublishTime > 1f / publishRate)\n        {\n            CaptureAndPublishImage();\n            lastPublishTime = Time.time;\n        }\n    }\n\n    void CaptureAndPublishImage()\n    {\n        // Set the active render texture to our camera\'s render texture\n        RenderTexture.active = renderTexture;\n\n        // Read pixels from the active render texture\n        texture2D.ReadPixels(new Rect(0, 0, imageWidth, imageHeight), 0, 0);\n        texture2D.Apply();\n\n        // Convert to byte array\n        byte[] imageBytes = texture2D.EncodeToJPG(85); // Use JPG for smaller size\n\n        // Create ROS image message\n        ImageMsg imageMsg = new ImageMsg\n        {\n            header = new HeaderMsg\n            {\n                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.Builtin_interfaces.TimeMsg\n                {\n                    sec = (int)Time.time,\n                    nanosec = (uint)((Time.time % 1) * 1e9)\n                },\n                frame_id = "camera_optical_frame"\n            },\n            height = (uint)imageHeight,\n            width = (uint)imageWidth,\n            encoding = "rgb8",\n            is_bigendian = 0,\n            step = (uint)(imageWidth * 3), // 3 bytes per pixel for RGB\n            data = imageBytes\n        };\n\n        m_RosConnection.Publish(imageTopic, imageMsg);\n\n        // Also publish camera info\n        PublishCameraInfo();\n    }\n\n    void PublishCameraInfo()\n    {\n        CameraInfoMsg infoMsg = new CameraInfoMsg\n        {\n            header = new HeaderMsg\n            {\n                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.Builtin_interfaces.TimeMsg\n                {\n                    sec = (int)Time.time,\n                    nanosec = (uint)((Time.time % 1) * 1e9)\n                },\n                frame_id = "camera_optical_frame"\n            },\n            height = (uint)imageHeight,\n            width = (uint)imageWidth,\n            distortion_model = "plumb_bob",\n            d = { 0, 0, 0, 0, 0 }, // No distortion for simplicity\n            k = {\n                CalculateFx(), 0, CalculateCx(),\n                0, CalculateFy(), CalculateCy(),\n                0, 0, 1\n            }, // Camera matrix\n            r = { 1, 0, 0, 0, 1, 0, 0, 0, 1 }, // Rectification matrix\n            p = {\n                CalculateFx(), 0, CalculateCx(), 0,\n                0, CalculateFy(), CalculateCy(), 0,\n                0, 0, 1, 0\n            } // Projection matrix\n        };\n\n        m_RosConnection.Publish(infoTopic, infoMsg);\n    }\n\n    float CalculateFx() => imageWidth / (2.0f * Mathf.Tan(Mathf.Deg2Rad * fov / 2.0f));\n    float CalculateFy() => CalculateFx(); // Assume square pixels\n    float CalculateCx() => imageWidth / 2.0f;\n    float CalculateCy() => imageHeight / 2.0f;\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"2-imu-sensor-setup",children:"2. IMU Sensor Setup"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// UnityIMUMsg.cs - IMU sensor simulation\n\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor_msgs;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs;\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry_msgs;\n\npublic class UnityIMUMsg : MonoBehaviour\n{\n    [Header("IMU Settings")]\n    public string imuTopic = "/imu/data";\n    public float publishRate = 100f; // Hz\n\n    [Header("Noise Parameters")]\n    public Vector3 linearAccelerationNoise = new Vector3(0.01f, 0.01f, 0.01f);\n    public Vector3 angularVelocityNoise = new Vector3(0.01f, 0.01f, 0.01f);\n\n    private RosConnection m_RosConnection;\n    private float lastPublishTime;\n    private Rigidbody attachedRigidbody;\n\n    void Start()\n    {\n        m_RosConnection = RosConnection.instance;\n        attachedRigidbody = GetComponent<Rigidbody>() ?? GetComponentInParent<Rigidbody>();\n    }\n\n    void Update()\n    {\n        if (m_RosConnection != null && Time.time - lastPublishTime > 1f / publishRate)\n        {\n            PublishIMUData();\n            lastPublishTime = Time.time;\n        }\n    }\n\n    void PublishIMUData()\n    {\n        // Get the robot\'s orientation, angular velocity, and linear acceleration\n        Quaternion orientation = transform.rotation;\n        Vector3 angularVelocity = attachedRigidbody ? attachedRigidbody.angularVelocity : Vector3.zero;\n        Vector3 linearAcceleration = attachedRigidbody ? attachedRigidbody.velocity : Vector3.zero;\n\n        // Apply noise\n        linearAcceleration += new Vector3(\n            Random.Range(-linearAccelerationNoise.x, linearAccelerationNoise.x),\n            Random.Range(-linearAccelerationNoise.y, linearAccelerationNoise.y),\n            Random.Range(-linearAccelerationNoise.z, linearAccelerationNoise.z)\n        );\n\n        angularVelocity += new Vector3(\n            Random.Range(-angularVelocityNoise.x, angularVelocityNoise.x),\n            Random.Range(-angularVelocityNoise.y, angularVelocityNoise.y),\n            Random.Range(-angularVelocityNoise.z, angularVelocityNoise.z)\n        );\n\n        // Create IMU message\n        ImuMsg imuMsg = new ImuMsg\n        {\n            header = new HeaderMsg\n            {\n                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.Builtin_interfaces.TimeMsg\n                {\n                    sec = (int)Time.time,\n                    nanosec = (uint)((Time.time % 1) * 1e9)\n                },\n                frame_id = "imu_link"\n            },\n            orientation = new QuaternionMsg\n            {\n                x = orientation.x,\n                y = orientation.y,\n                z = orientation.z,\n                w = orientation.w\n            },\n            angular_velocity = new Vector3Msg\n            {\n                x = angularVelocity.x,\n                y = angularVelocity.y,\n                z = angularVelocity.z\n            },\n            linear_acceleration = new Vector3Msg\n            {\n                x = linearAcceleration.x,\n                y = linearAcceleration.y,\n                z = linearAcceleration.z - Physics.gravity.y // Subtract gravity\n            }\n        };\n\n        m_RosConnection.Publish(imuTopic, imuMsg);\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"ros-2-bridge-configuration",children:"ROS 2 Bridge Configuration"}),"\n",(0,o.jsx)(e.h3,{id:"1-setting-up-the-ros-tcp-endpoint",children:"1. Setting up the ROS-TCP-Endpoint"}),"\n",(0,o.jsx)(e.p,{children:"Create a ROS 2 node to act as the TCP endpoint:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"# ros_tcp_endpoint.py - ROS 2 TCP endpoint node\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom sensor_msgs.msg import JointState\nfrom geometry_msgs.msg import Twist\nimport socket\nimport threading\nimport json\nimport struct\n\nclass ROSEndpoint(Node):\n    def __init__(self):\n        super().__init__('unity_ros_endpoint')\n\n        # Parameters\n        self.declare_parameter('tcp_port', 10000)\n        self.tcp_port = self.get_parameter('tcp_port').value\n        self.tcp_ip = '0.0.0.0'  # Listen on all interfaces\n\n        # ROS publishers/subscribers\n        self.joint_state_pub = self.create_publisher(JointState, '/joint_states', 10)\n        self.unity_test_sub = self.create_subscription(String, '/unity_test_topic', self.unity_test_callback, 10)\n\n        # Start TCP server\n        self.tcp_server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        self.tcp_server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n        self.tcp_server.bind((self.tcp_ip, self.tcp_port))\n        self.tcp_server.listen(5)\n\n        self.get_logger().info(f'ROS TCP Endpoint listening on {self.tcp_ip}:{self.tcp_port}')\n\n        # Start server thread\n        self.server_thread = threading.Thread(target=self.tcp_server_loop)\n        self.server_thread.daemon = True\n        self.server_thread.start()\n\n    def tcp_server_loop(self):\n        while rclpy.ok():\n            try:\n                client_socket, address = self.tcp_server.accept()\n                self.get_logger().info(f'Connection from {address}')\n\n                # Handle client in separate thread\n                client_thread = threading.Thread(target=self.handle_client, args=(client_socket,))\n                client_thread.daemon = True\n                client_thread.start()\n\n            except Exception as e:\n                self.get_logger().error(f'Server error: {e}')\n\n    def handle_client(self, client_socket):\n        try:\n            while rclpy.ok():\n                # Receive message length (4 bytes)\n                length_data = client_socket.recv(4)\n                if not length_data:\n                    break\n\n                msg_length = struct.unpack('<I', length_data)[0]\n\n                # Receive message data\n                data = b''\n                while len(data) < msg_length:\n                    packet = client_socket.recv(msg_length - len(data))\n                    if not packet:\n                        break\n                    data += packet\n\n                # Process message\n                self.process_message(data.decode('utf-8'))\n\n        except Exception as e:\n            self.get_logger().error(f'Client error: {e}')\n        finally:\n            client_socket.close()\n\n    def process_message(self, message_str):\n        try:\n            message = json.loads(message_str)\n\n            # Process based on message type\n            msg_type = message.get('type', '')\n            topic = message.get('topic', '')\n            data = message.get('data', {})\n\n            if topic == '/joint_states':\n                self.publish_joint_states(data)\n            elif topic == '/unity_test_topic':\n                self.get_logger().info(f'Received from Unity: {data}')\n\n        except Exception as e:\n            self.get_logger().error(f'Message processing error: {e}')\n\n    def publish_joint_states(self, data):\n        msg = JointState()\n        # Parse and populate joint state message\n        # Implementation depends on your specific message format\n        pass\n\n    def unity_test_callback(self, msg):\n        self.get_logger().info(f'Received from Unity: {msg.data}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    endpoint = ROSEndpoint()\n\n    try:\n        rclpy.spin(endpoint)\n    except KeyboardInterrupt:\n        endpoint.get_logger().info('Shutting down ROS TCP endpoint')\n    finally:\n        endpoint.tcp_server.close()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,o.jsx)(e.h3,{id:"2-launch-file-for-unity-integration",children:"2. Launch File for Unity Integration"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-xml",children:'\x3c!-- launch/unity_robotics.launch --\x3e\n<launch>\n  \x3c!-- ROS TCP Endpoint --\x3e\n  <node pkg="my_robot_description" exec="ros_tcp_endpoint.py" name="ros_tcp_endpoint">\n    <param name="tcp_port" value="10000"/>\n  </node>\n\n  \x3c!-- Robot State Publisher --\x3e\n  <node pkg="robot_state_publisher" exec="robot_state_publisher" name="robot_state_publisher">\n    <param name="robot_description" value="$(find-pkg-share my_robot_description)/urdf/humanoid.urdf"/>\n  </node>\n\n  \x3c!-- Joint State Publisher --\x3e\n  <node pkg="joint_state_publisher" exec="joint_state_publisher" name="joint_state_publisher"/>\n\n</launch>\n'})}),"\n",(0,o.jsx)(e.h2,{id:"testing-the-unity-setup",children:"Testing the Unity Setup"}),"\n",(0,o.jsx)(e.h3,{id:"1-basic-connection-test",children:"1. Basic Connection Test"}),"\n",(0,o.jsx)(e.p,{children:"Create a simple test scene to verify the connection:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// ConnectionTest.cs - Simple connection test\n\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\n\npublic class ConnectionTest : MonoBehaviour\n{\n    public string testTopic = "connection_test";\n    public float testInterval = 2.0f;\n\n    private RosConnection m_RosConnection;\n    private float lastTestTime;\n\n    void Start()\n    {\n        m_RosConnection = RosConnection.instance;\n\n        if (m_RosConnection != null)\n        {\n            // Subscribe to echo back\n            m_RosConnection.Subscribe<Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg>(\n                testTopic + "_echo", OnEchoReceived);\n\n            Debug.Log("Connection test initialized");\n        }\n        else\n        {\n            Debug.LogError("No ROS connection available!");\n        }\n    }\n\n    void Update()\n    {\n        if (m_RosConnection != null && Time.time - lastTestTime > testInterval)\n        {\n            SendTestMessage();\n            lastTestTime = Time.time;\n        }\n    }\n\n    void SendTestMessage()\n    {\n        if (m_RosConnection != null)\n        {\n            var msg = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg\n            {\n                data = $"Unity test message at {Time.time}"\n            };\n\n            m_RosConnection.Publish(testTopic, msg);\n            Debug.Log($"Sent test message: {msg.data}");\n        }\n    }\n\n    void OnEchoReceived(Unity.Robotics.ROSTCPConnector.MessageTypes.Std_msgs.StringMsg msg)\n    {\n        Debug.Log($"Received echo: {msg.data}");\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,o.jsx)(e.h3,{id:"1-unity-physics-optimization",children:"1. Unity Physics Optimization"}),"\n",(0,o.jsx)(e.p,{children:"For humanoid robot simulation, optimize Unity's physics settings:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// PhysicsOptimizer.cs - Physics optimization script\n\nusing UnityEngine;\n\n[ExecuteInEditMode]\npublic class PhysicsOptimizer : MonoBehaviour\n{\n    [Header("Physics Settings")]\n    public int fixedTimestep = 50; // 50 Hz = 0.02s\n    public int maxSubsteps = 8;\n    public int solverIterations = 6;\n    public int solverVelocityIterations = 1;\n\n    void OnValidate()\n    {\n        OptimizePhysics();\n    }\n\n    void OptimizePhysics()\n    {\n        // Set physics timestep for humanoid simulation\n        Time.fixedDeltaTime = 1.0f / fixedTimestep;\n        Time.maximumDeltaTime = 1.0f / 10; // 10 Hz max\n        Time.maxFixedDeltaTime = 1.0f / 10; // 10 Hz max\n\n        // Physics manager settings\n        Physics.defaultSolverIterations = solverIterations;\n        Physics.defaultSolverVelocityIterations = solverVelocityIterations;\n        Physics.maxAngularVelocity = 50f; // Reasonable limit for humanoid joints\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"2-graphics-optimization",children:"2. Graphics Optimization"}),"\n",(0,o.jsx)(e.p,{children:"For better performance with complex humanoid models:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-csharp",children:'// GraphicsOptimizer.cs - Graphics optimization for simulation\n\nusing UnityEngine;\n\npublic class GraphicsOptimizer : MonoBehaviour\n{\n    [Header("Graphics Settings for Simulation")]\n    public bool useLowQuality = true;\n    public int targetFrameRate = 60;\n    public ShadowQuality shadowQuality = ShadowQuality.Low;\n    public LODBias lodBias = LODBias.Low;\n\n    void Start()\n    {\n        OptimizeForSimulation();\n    }\n\n    void OptimizeForSimulation()\n    {\n        if (useLowQuality)\n        {\n            QualitySettings.SetQualityLevel(0); // Lowest quality\n        }\n\n        Application.targetFrameRate = targetFrameRate;\n        QualitySettings.shadows = shadowQuality;\n        QualitySettings.lodBias = (float)lodBias;\n\n        // Disable expensive effects for simulation\n        RenderSettings.fog = false;\n        RenderSettings.ambientMode = UnityEngine.Rendering.AmbientMode.Trilight;\n    }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsx)(e.p,{children:"Now that you have Unity properly set up for robotics simulation, let's explore how to create more complex environments and integrate advanced features. In the next section, we'll cover environment creation and physics optimization specifically for humanoid robots in Unity."})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>a});var t=i(6540);const o={},s=t.createContext(o);function r(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);