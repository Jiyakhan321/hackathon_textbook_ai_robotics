"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[7560],{2075:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1-robotic-nervous-system/python-agents/rclpy-basics","title":"rclpy Basics: Python Client Library for ROS 2","description":"Introduction to rclpy","source":"@site/docs/module-1-robotic-nervous-system/python-agents/rclpy-basics.md","sourceDirName":"module-1-robotic-nervous-system/python-agents","slug":"/module-1-robotic-nervous-system/python-agents/rclpy-basics","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/python-agents/rclpy-basics","draft":false,"unlisted":false,"editUrl":"https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics/tree/main/docs/module-1-robotic-nervous-system/python-agents/rclpy-basics.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Lifecycle Nodes","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/ros2-architecture/lifecycle-nodes"},"next":{"title":"Creating Specialized ROS 2 Nodes","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/python-agents/creating-nodes"}}');var s=r(4848),t=r(8453);const o={sidebar_position:1},l="rclpy Basics: Python Client Library for ROS 2",a={},c=[{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Installation and Setup",id:"installation-and-setup",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:2},{value:"Creating Publishers",id:"creating-publishers",level:2},{value:"Creating Subscribers",id:"creating-subscribers",level:2},{value:"Creating Services",id:"creating-services",level:2},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Working with Parameters",id:"working-with-parameters",level:2},{value:"Quality of Service (QoS) Settings",id:"quality-of-service-qos-settings",level:2},{value:"Working with Time",id:"working-with-time",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Proper Resource Management",id:"1-proper-resource-management",level:3},{value:"2. Error Handling",id:"2-error-handling",level:3},{value:"3. Logging",id:"3-logging",level:3},{value:"Common Patterns for Humanoid Robots",id:"common-patterns-for-humanoid-robots",level:2},{value:"Joint State Publisher",id:"joint-state-publisher",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rclpy-basics-python-client-library-for-ros-2",children:"rclpy Basics: Python Client Library for ROS 2"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,s.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2. It provides a Python API to interact with the ROS 2 middleware, allowing you to create nodes, publish and subscribe to topics, provide and call services, and more."}),"\n",(0,s.jsx)(n.h2,{id:"installation-and-setup",children:"Installation and Setup"}),"\n",(0,s.jsx)(n.p,{children:"rclpy is typically installed as part of the ROS 2 distribution. Make sure you have sourced your ROS 2 environment:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash  # or your ROS 2 distribution\n"})}),"\n",(0,s.jsx)(n.h2,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,s.jsx)(n.p,{children:"Here's the minimal structure of a ROS 2 node using rclpy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MinimalNode(Node):\n    def __init__(self):\n        super().__init__('minimal_node')\n        self.get_logger().info('Minimal node created')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MinimalNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-publishers",children:"Creating Publishers"}),"\n",(0,s.jsx)(n.p,{children:"Publishers send messages to topics. Here's how to create a publisher:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass PublisherNode(Node):\n    def __init__(self):\n        super().__init__('publisher_node')\n\n        # Create a publisher\n        self.publisher = self.create_publisher(\n            String,           # Message type\n            'topic_name',     # Topic name\n            10                # QoS queue size\n        )\n\n        # Create a timer to publish periodically\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Hello World: {self.i}'\n        self.publisher.publish(msg)\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = PublisherNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-subscribers",children:"Creating Subscribers"}),"\n",(0,s.jsx)(n.p,{children:"Subscribers receive messages from topics:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass SubscriberNode(Node):\n    def __init__(self):\n        super().__init__('subscriber_node')\n\n        # Create a subscription\n        self.subscription = self.create_subscription(\n            String,           # Message type\n            'topic_name',     # Topic name\n            self.listener_callback,  # Callback function\n            10                # QoS queue size\n        )\n\n        # Prevent unused variable warning\n        self.subscription  # type: ignore\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SubscriberNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"creating-services",children:"Creating Services"}),"\n",(0,s.jsx)(n.p,{children:"Services provide request-response communication:"}),"\n",(0,s.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceServerNode(Node):\n    def __init__(self):\n        super().__init__('service_server_node')\n\n        # Create a service\n        self.srv = self.create_service(\n            AddTwoInts,           # Service type\n            'add_two_ints',       # Service name\n            self.add_two_ints_callback  # Callback function\n        )\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning: {request.a} + {request.b} = {response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ServiceServerNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceClientNode(Node):\n    def __init__(self):\n        super().__init__('service_client_node')\n\n        # Create a client\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n\n        # Wait for service to be available\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n\n        self.request = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.request.a = a\n        self.request.b = b\n        self.future = self.cli.call_async(self.request)\n        return self.future\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ServiceClientNode()\n\n    # Send request\n    future = node.send_request(1, 2)\n\n    try:\n        rclpy.spin_until_future_complete(node, future)\n        response = future.result()\n        node.get_logger().info(f'Result: {response.sum}')\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-parameters",children:"Working with Parameters"}),"\n",(0,s.jsx)(n.p,{children:"Parameters allow configuration of nodes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom rclpy.parameter import Parameter\n\nclass ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('robot_name', 'humanoid_robot')\n        self.declare_parameter('max_velocity', 1.0)\n        self.declare_parameter('joint_limits', [1.57, 1.57, 1.57])\n\n        # Get parameter values\n        self.robot_name = self.get_parameter('robot_name').value\n        self.max_velocity = self.get_parameter('max_velocity').value\n        self.joint_limits = self.get_parameter('joint_limits').value\n\n        self.get_logger().info(f'Robot: {self.robot_name}, Max velocity: {self.max_velocity}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ParameterNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"quality-of-service-qos-settings",children:"Quality of Service (QoS) Settings"}),"\n",(0,s.jsx)(n.p,{children:"QoS settings control how messages are delivered:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\n\nclass QoSNode(Node):\n    def __init__(self):\n        super().__init__('qos_node')\n\n        # Create QoS profile for reliable delivery\n        qos_profile = QoSProfile(\n            depth=10,\n            reliability=ReliabilityPolicy.RELIABLE,\n            durability=DurabilityPolicy.VOLATILE\n        )\n\n        self.publisher = self.create_publisher(String, 'reliable_topic', qos_profile)\n        self.subscription = self.create_subscription(\n            String, 'reliable_topic', self.listener_callback, qos_profile\n        )\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'Received: {msg.data}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = QoSNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"working-with-time",children:"Working with Time"}),"\n",(0,s.jsx)(n.p,{children:"ROS 2 provides various time utilities:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom builtin_interfaces.msg import Time\nfrom rclpy.time import Time as RclpyTime\n\nclass TimeNode(Node):\n    def __init__(self):\n        super().__init__('time_node')\n\n        # Get current ROS time\n        current_time = self.get_clock().now()\n        self.get_logger().info(f'Current time: {current_time}')\n\n        # Create timer\n        self.timer = self.create_timer(1.0, self.timer_callback)\n\n    def timer_callback(self):\n        # Get time when callback is executed\n        callback_time = self.get_clock().now()\n        self.get_logger().info(f'Timer callback at: {callback_time}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TimeNode()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-proper-resource-management",children:"1. Proper Resource Management"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass BestPracticeNode(Node):\n    def __init__(self):\n        super().__init__('best_practice_node')\n        self.publishers = []\n        self.subscribers = []\n        self.timers = []\n\n        # Create resources\n        pub = self.create_publisher(String, 'topic', 10)\n        self.publishers.append(pub)\n\n        timer = self.create_timer(1.0, self.timer_callback)\n        self.timers.append(timer)\n\n    def timer_callback(self):\n        self.get_logger().info('Timer callback')\n\n    def destroy_node(self):\n        # Clean up resources explicitly\n        for pub in self.publishers:\n            self.destroy_publisher(pub)\n        for sub in self.subscribers:\n            self.destroy_subscription(sub)\n        for timer in self.timers:\n            self.destroy_timer(timer)\n\n        return super().destroy_node()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-error-handling",children:"2. Error Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def safe_publisher(node, msg_type, topic_name, queue_size=10):\n    try:\n        publisher = node.create_publisher(msg_type, topic_name, queue_size)\n        return publisher\n    except Exception as e:\n        node.get_logger().error(f'Failed to create publisher: {e}')\n        return None\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-logging",children:"3. Logging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def log_with_context(node, level, message, context=None):\n    if context:\n        message = f'[{context}] {message}'\n    node.get_logger().log(level, message)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-patterns-for-humanoid-robots",children:"Common Patterns for Humanoid Robots"}),"\n",(0,s.jsx)(n.h3,{id:"joint-state-publisher",children:"Joint State Publisher"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nfrom builtin_interfaces.msg import Time\n\nclass JointStatePublisher(Node):\n    def __init__(self):\n        super().__init__('joint_state_publisher')\n\n        self.publisher = self.create_publisher(JointState, 'joint_states', 10)\n        self.timer = self.create_timer(0.05, self.publish_joint_states)  # 20 Hz\n\n        # Initialize joint names for humanoid\n        self.joint_names = [\n            'left_hip_joint', 'left_knee_joint', 'left_ankle_joint',\n            'right_hip_joint', 'right_knee_joint', 'right_ankle_joint',\n            'left_shoulder_joint', 'left_elbow_joint', 'left_wrist_joint',\n            'right_shoulder_joint', 'right_elbow_joint', 'right_wrist_joint'\n        ]\n\n        # Initialize joint positions\n        self.joint_positions = [0.0] * len(self.joint_names)\n\n    def publish_joint_states(self):\n        msg = JointState()\n        msg.name = self.joint_names\n        msg.position = self.joint_positions\n\n        # Set timestamp\n        time = self.get_clock().now().to_msg()\n        msg.header.stamp = time\n        msg.header.frame_id = 'base_link'\n\n        self.publisher.publish(msg)\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointStatePublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsx)(n.p,{children:"Now that you understand rclpy basics, let's look at how to create specific types of nodes for humanoid robot control."})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);