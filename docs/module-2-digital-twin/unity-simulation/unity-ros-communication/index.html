<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-module-2-digital-twin/unity-simulation/unity-ros-communication" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Unity-ROS Communication Implementation | Physical AI &amp; Humanoid Robotics</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Unity-ROS Communication Implementation | Physical AI &amp; Humanoid Robotics"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/hackathon_textbook_ai_robotics/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication"><link data-rh="true" rel="alternate" href="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication" hreflang="en"><link data-rh="true" rel="alternate" href="https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Unity-ROS Communication Implementation","item":"https://Jiyakhan321.github.io/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication"}]}</script><link rel="alternate" type="application/rss+xml" href="/hackathon_textbook_ai_robotics/blog/rss.xml" title="Physical AI &amp; Humanoid Robotics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/hackathon_textbook_ai_robotics/blog/atom.xml" title="Physical AI &amp; Humanoid Robotics Atom Feed"><link rel="stylesheet" href="/hackathon_textbook_ai_robotics/assets/css/styles.014a64ea.css">
<script src="/hackathon_textbook_ai_robotics/assets/js/runtime~main.d02a6aa1.js" defer="defer"></script>
<script src="/hackathon_textbook_ai_robotics/assets/js/main.6b2fd9e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/hackathon_textbook_ai_robotics/img/home-icon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hackathon_textbook_ai_robotics/"><div class="navbar__logo"><img src="/hackathon_textbook_ai_robotics/img/home-icon.svg" alt="Home Icon" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32" width="32"><img src="/hackathon_textbook_ai_robotics/img/home-icon.svg" alt="Home Icon" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32" width="32"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hackathon_textbook_ai_robotics/docs/intro">Book</a><a class="navbar__item navbar__link" href="/hackathon_textbook_ai_robotics/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/hackathon_textbook_ai_robotics/docs/intro"><span title="Tutorial Intro" class="linkLabel_WmDU">Tutorial Intro</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/hackathon_textbook_ai_robotics/docs/physical-ai-humanoid-robotics"><span title="Physical AI &amp; Humanoid Robotics Book" class="linkLabel_WmDU">Physical AI &amp; Humanoid Robotics Book</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/intro"><span title="Module 1: The Robotic Nervous System (ROS 2)" class="categoryLinkLabel_W154">Module 1: The Robotic Nervous System (ROS 2)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/intro"><span title="Module 2: The Digital Twin (Gazebo &amp; Unity)" class="categoryLinkLabel_W154">Module 2: The Digital Twin (Gazebo &amp; Unity)</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/intro"><span title="Module 2: The Digital Twin (Gazebo &amp; Unity)" class="linkLabel_WmDU">Module 2: The Digital Twin (Gazebo &amp; Unity)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/gazebo-simulation/environment-design"><span title="Gazebo Simulation" class="categoryLinkLabel_W154">Gazebo Simulation</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-robotics-setup"><span title="Unity Simulation" class="categoryLinkLabel_W154">Unity Simulation</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-robotics-setup"><span title="Unity Robotics Setup and Configuration" class="linkLabel_WmDU">Unity Robotics Setup and Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/environment-creation"><span title="Environment Creation for Humanoid Robots in Unity" class="linkLabel_WmDU">Environment Creation for Humanoid Robots in Unity</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/unity-ros-communication"><span title="Unity-ROS Communication Implementation" class="linkLabel_WmDU">Unity-ROS Communication Implementation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/sensor-simulation"><span title="Sensor Simulation in Unity" class="linkLabel_WmDU">Sensor Simulation in Unity</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/conclusion"><span title="Module 2 Conclusion: Complete Digital Twin Implementation" class="linkLabel_WmDU">Module 2 Conclusion: Complete Digital Twin Implementation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/hackathon_textbook_ai_robotics/docs/module-3-ai-robot-brain/intro"><span title="Module 3: AI-Robot Brain (NVIDIA Isaac)" class="categoryLinkLabel_W154">Module 3: AI-Robot Brain (NVIDIA Isaac)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/hackathon_textbook_ai_robotics/docs/module-4-vision-language-action/intro"><span title="Module 4: Vision-Language-Action (VLA)" class="categoryLinkLabel_W154">Module 4: Vision-Language-Action (VLA)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/hackathon_textbook_ai_robotics/docs/specs/physical-ai-humanoid-textbook/checklists/requirements"><span title="Specifications" class="categoryLinkLabel_W154">Specifications</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hackathon_textbook_ai_robotics/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Module 2: The Digital Twin (Gazebo &amp; Unity)</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Unity Simulation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Unity-ROS Communication Implementation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unity-ROS Communication Implementation</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Establishing reliable communication between Unity and ROS 2 is crucial for creating effective digital twin environments for humanoid robots. This section covers the implementation of ROS communication in Unity using the Unity Robotics Hub, focusing on real-time data exchange, sensor simulation, and control systems.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-ros-communication-in-unity">Setting Up ROS Communication in Unity<a href="#setting-up-ros-communication-in-unity" class="hash-link" aria-label="Direct link to Setting Up ROS Communication in Unity" title="Direct link to Setting Up ROS Communication in Unity" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-ros-tcp-connector-configuration">1. ROS TCP Connector Configuration<a href="#1-ros-tcp-connector-configuration" class="hash-link" aria-label="Direct link to 1. ROS TCP Connector Configuration" title="Direct link to 1. ROS TCP Connector Configuration" translate="no">​</a></h3>
<p>The ROS TCP Connector is the primary communication bridge between Unity and ROS 2. Here&#x27;s how to properly configure it:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Std;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ROSCommunicationManager : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;ROS Connection Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string rosIPAddress = &quot;127.0.0.1&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int rosPort = 10000;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float connectionRetryDelay = 2.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Communication Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float publishRate = 50.0f; // Hz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private bool enableLogging = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSConnection rosConnection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private bool isConnected = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeROSConnection();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void InitializeROSConnection()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rosConnection = ROSConnection.instance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rosConnection.RegisteredAsConnected();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Attempt to connect to ROS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            StartCoroutine(TryConnectToROS());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        catch (System.Exception ex)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.LogError($&quot;Failed to initialize ROS connection: {ex.Message}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private IEnumerator TryConnectToROS()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while (!isConnected)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            try</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                rosConnection.ConnectToEditor(rosIPAddress, rosPort);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                isConnected = rosConnection.IsConnected();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (isConnected)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Debug.Log($&quot;Successfully connected to ROS at {rosIPAddress}:{rosPort}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    break;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        Debug.LogWarning($&quot;Connection failed, retrying in {connectionRetryDelay}s&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    yield return new WaitForSeconds(connectionRetryDelay);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            catch (System.Exception ex)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Debug.LogError($&quot;Connection error: {ex.Message}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                yield return new WaitForSeconds(connectionRetryDelay);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (isConnected)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            publishTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            float publishInterval = 1.0f / publishRate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (publishTimer &gt;= publishInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                PublishDataToROS();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void PublishDataToROS()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Override this method in derived classes to publish specific data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool IsConnected()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return isConnected &amp;&amp; rosConnection != null &amp;&amp; rosConnection.IsConnected();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void SendToROS(string topicName, object message)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (IsConnected())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rosConnection.SendUnityMessage(topicName, message);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.LogWarning($&quot;Cannot send to ROS: Not connected to topic {topicName}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void SubscribeToROS&lt;T&gt;(string topicName, System.Action&lt;T&gt; callback) where T : Message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (IsConnected())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rosConnection.Subscribe&lt;T&gt;(topicName, callback);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.LogWarning($&quot;Cannot subscribe to ROS: Not connected to topic {topicName}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void OnApplicationQuit()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (rosConnection != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            rosConnection.Disconnect();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-joint-state-publisher-for-humanoid-robots">2. Joint State Publisher for Humanoid Robots<a href="#2-joint-state-publisher-for-humanoid-robots" class="hash-link" aria-label="Direct link to 2. Joint State Publisher for Humanoid Robots" title="Direct link to 2. Joint State Publisher for Humanoid Robots" translate="no">​</a></h3>
<p>Publishing joint states from Unity to ROS 2 is essential for synchronization:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class JointStatePublisher : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Joint Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private ArticulationBody[] jointBodies;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string[] jointNames;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string robotName = &quot;humanoid_robot&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Publishing Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string jointStatesTopic = &quot;/joint_states&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float publishRate = 50.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSConnection rosConnection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private List&lt;double&gt; jointPositions;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private List&lt;double&gt; jointVelocities;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private List&lt;double&gt; jointEfforts;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeJointArrays();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection = ROSConnection.instance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void InitializeJointArrays()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (jointBodies.Length != jointNames.Length)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.LogError(&quot;Joint bodies and joint names arrays must have the same length!&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointPositions = new List&lt;double&gt;(new double[jointBodies.Length]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointVelocities = new List&lt;double&gt;(new double[jointBodies.Length]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointEfforts = new List&lt;double&gt;(new double[jointBodies.Length]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        publishTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float publishInterval = 1.0f / publishRate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (publishTimer &gt;= publishInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PublishJointStates();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void PublishJointStates()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (jointBodies == null || jointBodies.Length == 0 || rosConnection == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Update joint arrays with current values</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        for (int i = 0; i &lt; jointBodies.Length; i++)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (jointBodies[i] != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointPositions[i] = jointBodies[i].jointPosition[0];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointVelocities[i] = jointBodies[i].jointVelocity[0];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointEfforts[i] = jointBodies[i].jointForce[0];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Create and publish joint state message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        JointStateMsg jointState = new JointStateMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            name = jointNames,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            position = jointPositions.ToArray(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            velocity = jointVelocities.ToArray(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            effort = jointEfforts.ToArray(),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            header = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.HeaderMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.BuiltinInterfaces.TimeMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    sec = (int)Time.time,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    nanosec = (uint)((Time.time % 1) * 1000000000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                frame_id = robotName</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection.SendUnityMessage(jointStatesTopic, jointState);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void SetJointBodies(ArticulationBody[] bodies)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointBodies = bodies;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (jointNames == null || jointNames.Length != bodies.Length)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            jointNames = new string[bodies.Length];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            for (int i = 0; i &lt; bodies.Length; i++)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointNames[i] = bodies[i].name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeJointArrays();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-joint-state-subscriber-for-control-commands">3. Joint State Subscriber for Control Commands<a href="#3-joint-state-subscriber-for-control-commands" class="hash-link" aria-label="Direct link to 3. Joint State Subscriber for Control Commands" title="Direct link to 3. Joint State Subscriber for Control Commands" translate="no">​</a></h3>
<p>Receiving joint commands from ROS 2 to control the Unity robot:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class JointStateSubscriber : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Joint Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private Dictionary&lt;string, ArticulationBody&gt; jointMap = new Dictionary&lt;string, ArticulationBody&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string jointCommandsTopic = &quot;/joint_commands&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Control Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float positionGain = 3000f;  // kp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float velocityGain = 200f;   // kd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float forceLimit = 1000f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSConnection rosConnection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Dictionary&lt;string, double&gt; targetPositions = new Dictionary&lt;string, double&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Dictionary&lt;string, double&gt; targetVelocities = new Dictionary&lt;string, double&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection = ROSConnection.instance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Subscribe to joint commands</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection.Subscribe&lt;JointStateMsg&gt;(jointCommandsTopic, OnJointCommandReceived);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Initialize joint map</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeJointMap();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void InitializeJointMap()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointMap.Clear();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Find all ArticulationBodies in children</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ArticulationBody[] bodies = GetComponentsInChildren&lt;ArticulationBody&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        foreach (ArticulationBody body in bodies)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (!jointMap.ContainsKey(body.name))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointMap[body.name] = body;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void OnJointCommandReceived(JointStateMsg jointState)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        for (int i = 0; i &lt; jointState.name.Length; i++)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            string jointName = jointState.name[i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (jointMap.ContainsKey(jointName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // Store target positions and velocities</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (i &lt; jointState.position.Length)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    targetPositions[jointName] = jointState.position[i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (i &lt; jointState.velocity.Length)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    targetVelocities[jointName] = jointState.velocity[i];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void FixedUpdate()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ApplyJointCommands();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void ApplyJointCommands()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        foreach (var jointPair in jointMap)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            string jointName = jointPair.Key;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ArticulationBody jointBody = jointPair.Value;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (targetPositions.ContainsKey(jointName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                double targetPos = targetPositions[jointName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                // Set drive parameters for position control</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                ArticulationDrive drive = jointBody.xDrive;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.position = (float)targetPos;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.positionSpring = positionGain;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.positionDamper = velocityGain;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.forceLimit = forceLimit;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.upperLimit = jointBody.xDrive.upperLimit;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                drive.lowerLimit = jointBody.xDrive.lowerLimit;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                jointBody.xDrive = drive;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void AddJoint(string jointName, ArticulationBody jointBody)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!jointMap.ContainsKey(jointName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            jointMap[jointName] = jointBody;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="sensor-data-communication">Sensor Data Communication<a href="#sensor-data-communication" class="hash-link" aria-label="Direct link to Sensor Data Communication" title="Direct link to Sensor Data Communication" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-imu-sensor-publisher">1. IMU Sensor Publisher<a href="#1-imu-sensor-publisher" class="hash-link" aria-label="Direct link to 1. IMU Sensor Publisher" title="Direct link to 1. IMU Sensor Publisher" translate="no">​</a></h3>
<p>Publishing IMU data from Unity to ROS 2:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class IMUSensorPublisher : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;IMU Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string imuTopic = &quot;/imu/data&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private Transform imuTransform;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float publishRate = 100.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Noise Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float linearAccelerationNoise = 0.01f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float angularVelocityNoise = 0.001f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float orientationNoise = 0.0001f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSConnection rosConnection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Rigidbody attachedRigidbody;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection = ROSConnection.instance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (imuTransform == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            imuTransform = transform;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        attachedRigidbody = GetComponent&lt;Rigidbody&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        publishTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float publishInterval = 1.0f / publishRate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (publishTimer &gt;= publishInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PublishIMUData();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void PublishIMUData()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (rosConnection == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Get orientation (convert Unity to ROS coordinate system)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Quaternion orientation = imuTransform.rotation;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Convert from Unity (left-handed) to ROS (right-handed) coordinate system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        orientation = new Quaternion(orientation.x, orientation.y, -orientation.z, -orientation.w);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Get angular velocity</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Vector3 angularVelocity = Vector3.zero;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (attachedRigidbody != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            angularVelocity = attachedRigidbody.angularVelocity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Convert to ROS coordinate system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        angularVelocity = new Vector3(angularVelocity.x, angularVelocity.y, -angularVelocity.z);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Get linear acceleration (approximate from gravity and movement)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Vector3 linearAcceleration = Physics.gravity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (attachedRigidbody != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            linearAcceleration += attachedRigidbody.velocity / Time.fixedDeltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Convert to ROS coordinate system</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        linearAcceleration = new Vector3(linearAcceleration.x, linearAcceleration.y, -linearAcceleration.z);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Add noise to simulate real sensor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        orientation = AddOrientationNoise(orientation);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        angularVelocity = AddAngularVelocityNoise(angularVelocity);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        linearAcceleration = AddLinearAccelerationNoise(linearAcceleration);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ImuMsg imuMsg = new ImuMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            header = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.HeaderMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.BuiltinInterfaces.TimeMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    sec = (int)Time.time,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    nanosec = (uint)((Time.time % 1) * 1000000000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                frame_id = imuTransform.name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orientation = new QuaternionMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                x = orientation.x,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                y = orientation.y,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                z = orientation.z,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                w = orientation.w</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            angular_velocity = new Vector3Msg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                x = angularVelocity.x,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                y = angularVelocity.y,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                z = angularVelocity.z</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            linear_acceleration = new Vector3Msg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                x = linearAcceleration.x,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                y = linearAcceleration.y,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                z = linearAcceleration.z</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection.SendUnityMessage(imuTopic, imuMsg);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Quaternion AddOrientationNoise(Quaternion orientation)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (orientationNoise &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orientation.x += Random.Range(-orientationNoise, orientationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orientation.y += Random.Range(-orientationNoise, orientationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orientation.z += Random.Range(-orientationNoise, orientationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            orientation.w += Random.Range(-orientationNoise, orientationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Normalize quaternion</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            float magnitude = Mathf.Sqrt(orientation.x * orientation.x +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                       orientation.y * orientation.y +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                       orientation.z * orientation.z +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                                       orientation.w * orientation.w);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (magnitude &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                orientation.x /= magnitude;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                orientation.y /= magnitude;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                orientation.z /= magnitude;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                orientation.w /= magnitude;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return orientation;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Vector3 AddAngularVelocityNoise(Vector3 angularVelocity)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (angularVelocityNoise &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            angularVelocity.x += Random.Range(-angularVelocityNoise, angularVelocityNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            angularVelocity.y += Random.Range(-angularVelocityNoise, angularVelocityNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            angularVelocity.z += Random.Range(-angularVelocityNoise, angularVelocityNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return angularVelocity;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Vector3 AddLinearAccelerationNoise(Vector3 linearAcceleration)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (linearAccelerationNoise &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            linearAcceleration.x += Random.Range(-linearAccelerationNoise, linearAccelerationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            linearAcceleration.y += Random.Range(-linearAccelerationNoise, linearAccelerationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            linearAcceleration.z += Random.Range(-linearAccelerationNoise, linearAccelerationNoise);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return linearAcceleration;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-camera-sensor-publisher">2. Camera Sensor Publisher<a href="#2-camera-sensor-publisher" class="hash-link" aria-label="Direct link to 2. Camera Sensor Publisher" title="Direct link to 2. Camera Sensor Publisher" translate="no">​</a></h3>
<p>Publishing camera data from Unity cameras to ROS 2:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Threading.Tasks;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class CameraSensorPublisher : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Camera Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private Camera cameraComponent;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string imageTopic = &quot;/camera/image_raw&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string infoTopic = &quot;/camera/camera_info&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Image Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int imageWidth = 640;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int imageHeight = 480;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float publishRate = 30.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSConnection rosConnection;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private RenderTexture renderTexture;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Texture2D texture2D;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private byte[] imageBytes;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection = ROSConnection.instance;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (cameraComponent == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            cameraComponent = GetComponent&lt;Camera&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeCameraTexture();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void InitializeCameraTexture()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        renderTexture = new RenderTexture(imageWidth, imageHeight, 24);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        texture2D = new Texture2D(imageWidth, imageHeight, TextureFormat.RGB24, false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cameraComponent.targetTexture = renderTexture;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        publishTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float publishInterval = 1.0f / publishRate;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (publishTimer &gt;= publishInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            PublishCameraData();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            publishTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void PublishCameraData()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (rosConnection == null || cameraComponent == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Render the camera to texture</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        RenderTexture.active = renderTexture;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        cameraComponent.Render();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Read pixels from render texture</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        texture2D.ReadPixels(new Rect(0, 0, imageWidth, imageHeight), 0, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        texture2D.Apply();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Convert to byte array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        imageBytes = texture2D.EncodeToJPG();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Create and publish image message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ImageMsg imageMsg = new ImageMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            header = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.HeaderMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.BuiltinInterfaces.TimeMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    sec = (int)Time.time,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    nanosec = (uint)((Time.time % 1) * 1000000000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                frame_id = cameraComponent.name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            height = (uint)imageHeight,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            width = (uint)imageWidth,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            encoding = &quot;rgb8&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            is_bigendian = 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            step = (uint)(imageWidth * 3), // 3 bytes per pixel for RGB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data = imageBytes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection.SendUnityMessage(imageTopic, imageMsg);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Publish camera info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        PublishCameraInfo();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void PublishCameraInfo()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CameraInfoMsg cameraInfo = new CameraInfoMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            header = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.HeaderMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                stamp = new Unity.Robotics.ROSTCPConnector.MessageTypes.BuiltinInterfaces.TimeMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    sec = (int)Time.time,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    nanosec = (uint)((Time.time % 1) * 1000000000)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                frame_id = cameraComponent.name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            height = (uint)imageHeight,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            width = (uint)imageWidth,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            distortion_model = &quot;plumb_bob&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            D = new double[] { 0, 0, 0, 0, 0 }, // No distortion</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            K = new double[] {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                cameraComponent.focalLength * imageWidth / cameraComponent.sensorSize.x, 0, imageWidth / 2.0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                0, cameraComponent.focalLength * imageHeight / cameraComponent.sensorSize.y, imageHeight / 2.0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                0, 0, 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            R = new double[] { 1, 0, 0, 0, 1, 0, 0, 0, 1 },</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            P = new double[] {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                cameraComponent.focalLength * imageWidth / cameraComponent.sensorSize.x, 0, imageWidth / 2.0, 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                0, cameraComponent.focalLength * imageHeight / cameraComponent.sensorSize.y, imageHeight / 2.0, 0,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                0, 0, 1, 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosConnection.SendUnityMessage(infoTopic, cameraInfo);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void OnDestroy()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (renderTexture != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            RenderTexture.ReleaseTemporary(renderTexture);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communication-architecture-best-practices">Communication Architecture Best Practices<a href="#communication-architecture-best-practices" class="hash-link" aria-label="Direct link to Communication Architecture Best Practices" title="Direct link to Communication Architecture Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-network-configuration">1. Network Configuration<a href="#1-network-configuration" class="hash-link" aria-label="Direct link to 1. Network Configuration" title="Direct link to 1. Network Configuration" translate="no">​</a></h3>
<p>Proper network setup is essential for stable Unity-ROS communication:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[CreateAssetMenu(fileName = &quot;ROSNetworkConfig&quot;, menuName = &quot;ROS/Network Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ROSNetworkConfig : ScriptableObject</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Connection Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string rosIPAddress = &quot;127.0.0.1&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public int rosPort = 10000;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Performance Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public float publishRate = 50.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public float connectionRetryDelay = 2.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public int maxConnectionAttempts = 5;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Topic Configuration&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string jointStatesTopic = &quot;/joint_states&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string jointCommandsTopic = &quot;/joint_commands&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string imuTopic = &quot;/imu/data&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string imageTopic = &quot;/camera/image_raw&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string infoTopic = &quot;/camera/camera_info&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Quality of Service&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool enableCompression = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public float compressionQuality = 0.8f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool enableThrottling = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public float maxMessageRate = 100.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Security Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool enableEncryption = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public string encryptionKey = &quot;default_key&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void ValidateSettings()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rosPort = Mathf.Clamp(rosPort, 1024, 65535);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        publishRate = Mathf.Clamp(publishRate, 1.0f, 1000.0f);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        connectionRetryDelay = Mathf.Clamp(connectionRetryDelay, 0.1f, 10.0f);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        maxConnectionAttempts = Mathf.Clamp(maxConnectionAttempts, 1, 10);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-message-throttling-and-buffering">2. Message Throttling and Buffering<a href="#2-message-throttling-and-buffering" class="hash-link" aria-label="Direct link to 2. Message Throttling and Buffering" title="Direct link to 2. Message Throttling and Buffering" translate="no">​</a></h3>
<p>Implement message throttling to prevent network overload:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class MessageThrottler : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [System.Serializable]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public class TopicThrottleConfig</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public string topicName;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public float maxRateHz = 50.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public int maxBufferSize = 10;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private List&lt;TopicThrottleConfig&gt; throttleConfigs = new List&lt;TopicThrottleConfig&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Dictionary&lt;string, MessageBuffer&gt; messageBuffers = new Dictionary&lt;string, MessageBuffer&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [System.Serializable]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private class MessageBuffer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public Queue&lt;object&gt; buffer = new Queue&lt;object&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public float lastSendTime = 0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public float minInterval = 0.02f; // 50 Hz default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        public int maxBufferSize = 10;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        InitializeBuffers();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void InitializeBuffers()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        foreach (var config in throttleConfigs)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            MessageBuffer buffer = new MessageBuffer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                minInterval = 1.0f / config.maxRateHz,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                maxBufferSize = config.maxBufferSize</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messageBuffers[config.topicName] = buffer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool ShouldSendMessage(string topicName)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!messageBuffers.ContainsKey(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return true; // No throttling for this topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        MessageBuffer buffer = messageBuffers[topicName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float currentTime = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return (currentTime - buffer.lastSendTime) &gt;= buffer.minInterval;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void QueueMessage(string topicName, object message)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!messageBuffers.ContainsKey(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // If no buffer exists, send immediately</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        MessageBuffer buffer = messageBuffers[topicName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Add to buffer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        buffer.buffer.Enqueue(message);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Trim buffer if too large</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while (buffer.buffer.Count &gt; buffer.maxBufferSize)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            buffer.buffer.Dequeue();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool TryGetNextMessage(string topicName, out object message)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        message = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!messageBuffers.ContainsKey(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        MessageBuffer buffer = messageBuffers[topicName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (buffer.buffer.Count &gt; 0 &amp;&amp; ShouldSendMessage(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            message = buffer.buffer.Dequeue();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            buffer.lastSendTime = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling-and-diagnostics">Error Handling and Diagnostics<a href="#error-handling-and-diagnostics" class="hash-link" aria-label="Direct link to Error Handling and Diagnostics" title="Direct link to Error Handling and Diagnostics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-connection-monitoring">1. Connection Monitoring<a href="#1-connection-monitoring" class="hash-link" aria-label="Direct link to 1. Connection Monitoring" title="Direct link to 1. Connection Monitoring" translate="no">​</a></h3>
<p>Monitor and handle connection issues gracefully:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ROSConnectionMonitor : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Connection Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float heartbeatInterval = 1.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float timeoutThreshold = 5.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private bool enableReconnection = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Diagnostics&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private bool enableLogging = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float logInterval = 2.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float heartbeatTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float lastMessageTime = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private bool isConnectionHealthy = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSCommunicationManager communicationManager;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float logTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        communicationManager = GetComponent&lt;ROSCommunicationManager&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        lastMessageTime = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Update()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check heartbeat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        heartbeatTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (heartbeatTimer &gt;= heartbeatInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            SendHeartbeat();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            heartbeatTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Check for timeout</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        CheckConnectionTimeout();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Log diagnostics periodically</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            logTimer += Time.deltaTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (logTimer &gt;= logInterval)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                LogDiagnostics();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                logTimer = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void SendHeartbeat()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (communicationManager != null &amp;&amp; communicationManager.IsConnected())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Send a simple heartbeat message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            var heartbeatMsg = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.StringMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data = $&quot;heartbeat_{Time.time}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            communicationManager.SendToROS(&quot;/heartbeat&quot;, heartbeatMsg);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            lastMessageTime = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void CheckConnectionTimeout()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float timeSinceLastMessage = Time.time - lastMessageTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (timeSinceLastMessage &gt; timeoutThreshold)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (isConnectionHealthy)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    Debug.LogWarning(&quot;ROS connection timeout detected!&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                isConnectionHealthy = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (enableReconnection)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    StartCoroutine(AttemptReconnection());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            isConnectionHealthy = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private System.Collections.IEnumerator AttemptReconnection()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (communicationManager != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            if (enableLogging)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                Debug.Log(&quot;Attempting to reconnect to ROS...&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Wait a bit before attempting reconnection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            yield return new WaitForSeconds(1.0f);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // This would typically involve restarting the ROS connection</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Implementation depends on your specific ROS setup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void LogDiagnostics()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (communicationManager != null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            string status = communicationManager.IsConnected() ? &quot;CONNECTED&quot; : &quot;DISCONNECTED&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            float timeSinceLastMsg = Time.time - lastMessageTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.Log($&quot;ROS Connection Status: {status} | Last message: {timeSinceLastMsg:F1}s ago | Healthy: {isConnectionHealthy}&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public bool IsConnectionHealthy()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return isConnectionHealthy;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public float GetTimeSinceLastMessage()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return Time.time - lastMessageTime;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-optimization">Performance Optimization<a href="#performance-optimization" class="hash-link" aria-label="Direct link to Performance Optimization" title="Direct link to Performance Optimization" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-efficient-message-serialization">1. Efficient Message Serialization<a href="#1-efficient-message-serialization" class="hash-link" aria-label="Direct link to 1. Efficient Message Serialization" title="Direct link to 1. Efficient Message Serialization" translate="no">​</a></h3>
<p>Optimize message serialization for better performance:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using Unity.Robotics.ROSTCPConnector;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class OptimizedMessagePublisher : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Optimization Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private bool enableMessagePooling = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int messagePoolSize = 100;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Dictionary&lt;string, Queue&lt;object&gt;&gt; messagePool = new Dictionary&lt;string, Queue&lt;object&gt;&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private Dictionary&lt;string, int&gt; messageCount = new Dictionary&lt;string, int&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public T GetMessageFromPool&lt;T&gt;(string topicName) where T : new()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!enableMessagePooling)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return new T();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!messagePool.ContainsKey(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messagePool[topicName] = new Queue&lt;object&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messageCount[topicName] = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Queue&lt;object&gt; pool = messagePool[topicName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (pool.Count &gt; 0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return (T)pool.Dequeue();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messageCount[topicName]++;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return new T();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void ReturnMessageToPool(string topicName, object message)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!enableMessagePooling || message == null)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (!messagePool.ContainsKey(topicName))</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messagePool[topicName] = new Queue&lt;object&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Queue&lt;object&gt; pool = messagePool[topicName];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Limit pool size to prevent memory issues</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (pool.Count &lt; messagePoolSize)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pool.Enqueue(message);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Example of using pooled messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void PublishOptimizedJointState(string topicName, ArticulationBody[] joints, string[] jointNames)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        var jointState = GetMessageFromPool&lt;Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor.JointStateMsg&gt;(topicName);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Use the message...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jointState.name = jointNames;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // ... set other properties</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Publish the message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ROSConnection.instance.SendUnityMessage(topicName, jointState);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Return to pool after a delay or when appropriate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ReturnMessageToPool(topicName, jointState);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-and-validation">Testing and Validation<a href="#testing-and-validation" class="hash-link" aria-label="Direct link to Testing and Validation" title="Direct link to Testing and Validation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-communication-validation-script">1. Communication Validation Script<a href="#1-communication-validation-script" class="hash-link" aria-label="Direct link to 1. Communication Validation Script" title="Direct link to 1. Communication Validation Script" translate="no">​</a></h3>
<p>Test and validate the communication system:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">using UnityEngine;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ROSCommunicationValidator : MonoBehaviour</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Validation Settings&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float testDuration = 10.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float testInterval = 0.1f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private string testTopic = &quot;/test_communication&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [Header(&quot;Validation Results&quot;)]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private bool isConnected = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int messagesSent = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private int messagesReceived = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    [SerializeField] private float lastRoundTripTime = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private ROSCommunicationManager communicationManager;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private float testStartTime = 0.0f;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private bool isTesting = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void Start()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        communicationManager = GetComponent&lt;ROSCommunicationManager&gt;();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void StartValidationTest()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (isTesting) return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (communicationManager == null || !communicationManager.IsConnected())</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            Debug.LogError(&quot;Cannot start validation test: Not connected to ROS!&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        isTesting = true;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        testStartTime = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        messagesSent = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        messagesReceived = 0;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Subscribe to echo messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        communicationManager.SubscribeToROS&lt;Unity.Robotics.ROSTCPConnector.MessageTypes.Std.StringMsg&gt;(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &quot;/echo_test&quot;, OnEchoReceived);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        StartCoroutine(RunValidationTest());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private IEnumerator RunValidationTest()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        float testStart = Time.time;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        while ((Time.time - testStart) &lt; testDuration &amp;&amp; isTesting)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            // Send test message</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            var testMsg = new Unity.Robotics.ROSTCPConnector.MessageTypes.Std.StringMsg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                data = $&quot;test_{Time.time}_{messagesSent}&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            communicationManager.SendToROS(testTopic, testMsg);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            messagesSent++;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            yield return new WaitForSeconds(testInterval);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        EndValidationTest();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void OnEchoReceived(Unity.Robotics.ROSTCPConnector.MessageTypes.Std.StringMsg msg)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        messagesReceived++;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // Calculate round trip time if possible</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    private void EndValidationTest()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        isTesting = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Debug.Log($&quot;Communication Validation Results:\n&quot; +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 $&quot;Duration: {testDuration}s\n&quot; +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 $&quot;Messages Sent: {messagesSent}\n&quot; +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 $&quot;Messages Received: {messagesReceived}\n&quot; +</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                 $&quot;Success Rate: {(messagesReceived &gt; 0 ? (float)messagesReceived / messagesSent * 100 : 0):F1}%&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void StopValidationTest()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        isTesting = false;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    void OnValidate()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        testDuration = Mathf.Clamp(testDuration, 1.0f, 60.0f);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        testInterval = Mathf.Clamp(testInterval, 0.01f, 1.0f);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<p>Now that you have implemented comprehensive ROS communication in Unity for humanoid robots, you can integrate these components into your digital twin system. The communication layer provides the foundation for real-time synchronization between Unity and ROS 2, enabling realistic simulation and control of humanoid robots.</p>
<p>In the next section, we&#x27;ll explore sensor simulation in Unity, covering how to create realistic sensor data for cameras, LiDAR, IMU, and other sensors commonly used in humanoid robotics applications.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics/tree/main/docs/module-2-digital-twin/unity-simulation/unity-ros-communication.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/environment-creation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Environment Creation for Humanoid Robots in Unity</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hackathon_textbook_ai_robotics/docs/module-2-digital-twin/unity-simulation/sensor-simulation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Sensor Simulation in Unity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#setting-up-ros-communication-in-unity" class="table-of-contents__link toc-highlight">Setting Up ROS Communication in Unity</a><ul><li><a href="#1-ros-tcp-connector-configuration" class="table-of-contents__link toc-highlight">1. ROS TCP Connector Configuration</a></li><li><a href="#2-joint-state-publisher-for-humanoid-robots" class="table-of-contents__link toc-highlight">2. Joint State Publisher for Humanoid Robots</a></li><li><a href="#3-joint-state-subscriber-for-control-commands" class="table-of-contents__link toc-highlight">3. Joint State Subscriber for Control Commands</a></li></ul></li><li><a href="#sensor-data-communication" class="table-of-contents__link toc-highlight">Sensor Data Communication</a><ul><li><a href="#1-imu-sensor-publisher" class="table-of-contents__link toc-highlight">1. IMU Sensor Publisher</a></li><li><a href="#2-camera-sensor-publisher" class="table-of-contents__link toc-highlight">2. Camera Sensor Publisher</a></li></ul></li><li><a href="#communication-architecture-best-practices" class="table-of-contents__link toc-highlight">Communication Architecture Best Practices</a><ul><li><a href="#1-network-configuration" class="table-of-contents__link toc-highlight">1. Network Configuration</a></li><li><a href="#2-message-throttling-and-buffering" class="table-of-contents__link toc-highlight">2. Message Throttling and Buffering</a></li></ul></li><li><a href="#error-handling-and-diagnostics" class="table-of-contents__link toc-highlight">Error Handling and Diagnostics</a><ul><li><a href="#1-connection-monitoring" class="table-of-contents__link toc-highlight">1. Connection Monitoring</a></li></ul></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a><ul><li><a href="#1-efficient-message-serialization" class="table-of-contents__link toc-highlight">1. Efficient Message Serialization</a></li></ul></li><li><a href="#testing-and-validation" class="table-of-contents__link toc-highlight">Testing and Validation</a><ul><li><a href="#1-communication-validation-script" class="table-of-contents__link toc-highlight">1. Communication Validation Script</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hackathon_textbook_ai_robotics/docs/intro">Book</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/hackathon_textbook_ai_robotics/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Jiyakhan321/hackathon_textbook_ai_robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>